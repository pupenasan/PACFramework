<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<VariablesExchangeFile>
	<fileHeader company="Schneider Automation" product="Unity Pro XL V13.1 - 180823C" dateTime="date_and_time#2022-1-25-17:8:28" content="Variable source file" DTDVersion="41"></fileHeader>
	<contentHeader name="Project" version="0.0.000"></contentHeader>
	<dataBlock>
		<variables name="AIVARFN" typeName="AIVARFN"></variables>
		<variables name="AOVARFN" typeName="AOVARFN"></variables>
		<variables name="DIVARFN" typeName="DIVARFN"></variables>
		<variables name="DOVARFN" typeName="DOVARFN"></variables>
	</dataBlock>
	<FBSource nameOfFBType="AIVARFN" version="0.14" dateTime="dt#2022-01-16-21:06:08">
		<attribute name="TypeCodeCheckSumString" value="7F46"></attribute>
		<attribute name="TypeSignatureCheckSumString" value="EDAC"></attribute>
		<inOutParameters>
			<variables name="CHCFG" typeName="CH_CFG">
				<attribute name="PositionPin" value="1"></attribute>
			</variables>
			<variables name="AIVARCFG" typeName="AIVAR_CFG">
				<attribute name="PositionPin" value="2"></attribute>
			</variables>
			<variables name="AIVARHMI" typeName="AIVAR_HMI">
				<attribute name="PositionPin" value="3"></attribute>
			</variables>
			<variables name="VARBUF" typeName="VARBUF">
				<attribute name="PositionPin" value="4"></attribute>
			</variables>
			<variables name="PLCCFG" typeName="PLC_CFG">
				<attribute name="PositionPin" value="5"></attribute>
			</variables>
			<variables name="CHAI" typeName="ARRAY[0..8] OF CH_CFG">
				<attribute name="PositionPin" value="6"></attribute>
			</variables>
		</inOutParameters>
		<privateLocalVariables>
			<variables name="VRAW" typeName="INT"></variables>
			<variables name="BRK" typeName="BOOL"></variables>
			<variables name="OVRLD" typeName="BOOL"></variables>
			<variables name="BAD" typeName="BOOL"></variables>
			<variables name="ALDIS" typeName="BOOL"></variables>
			<variables name="DLNK" typeName="BOOL"></variables>
			<variables name="ENBL" typeName="BOOL"></variables>
			<variables name="ALM" typeName="BOOL"></variables>
			<variables name="LOLO" typeName="BOOL"></variables>
			<variables name="LO" typeName="BOOL"></variables>
			<variables name="HI" typeName="BOOL"></variables>
			<variables name="HIHI" typeName="BOOL"></variables>
			<variables name="WRN" typeName="BOOL"></variables>
			<variables name="INBUF" typeName="BOOL"></variables>
			<variables name="FRC" typeName="BOOL"></variables>
			<variables name="SML" typeName="BOOL"></variables>
			<variables name="CMDLOAD" typeName="BOOL"></variables>
			<variables name="CMD" typeName="UINT"></variables>
			<variables name="VARENBL" typeName="BOOL"></variables>
			<variables name="T_STEPMS" typeName="UDINT"></variables>
			<variables name="dT1" typeName="UDINT"></variables>
			<variables name="VAL" typeName="REAL"></variables>
			<variables name="LORAW" typeName="INT"></variables>
			<variables name="HIRAW" typeName="INT"></variables>
			<variables name="LOENG" typeName="REAL"></variables>
			<variables name="HIENG" typeName="REAL"></variables>
			<variables name="LOSP" typeName="REAL"></variables>
			<variables name="HISP" typeName="REAL"></variables>
			<variables name="LOLOSP" typeName="REAL"></variables>
			<variables name="HIHISP" typeName="REAL"></variables>
			<variables name="T_FLT" typeName="UDINT"></variables>
			<variables name="T_DEALL" typeName="UDINT"></variables>
			<variables name="T_DEAL" typeName="UDINT"></variables>
			<variables name="T_DEAH" typeName="UDINT"></variables>
			<variables name="T_DEAHH" typeName="UDINT"></variables>
			<variables name="HYST" typeName="REAL"></variables>
			<variables name="tmpDWORD" typeName="DWORD"></variables>
			<variables name="VAL1PROC" typeName="REAL"></variables>
			<variables name="VALNOFLT" typeName="REAL"></variables>
			<variables name="tmpOVRLD" typeName="BOOL"></variables>
			<variables name="tmpBRK" typeName="BOOL"></variables>
			<variables name="tmpHI" typeName="BOOL"></variables>
			<variables name="tmpHIHI" typeName="BOOL"></variables>
			<variables name="tmpLO" typeName="BOOL"></variables>
			<variables name="tmpLOLO" typeName="BOOL"></variables>
			<variables name="tmpAFRZ" typeName="BOOL"></variables>
			<variables name="tmpASPD" typeName="BOOL"></variables>
			<variables name="tmpAOVRFL" typeName="BOOL"></variables>
			<variables name="tmpAUNDRFL" typeName="BOOL"></variables>
			<variables name="T_DEAQALSP" typeName="INT"></variables>
			<variables name="VALPROC" typeName="REAL"></variables>
			<variables name="VALPRV" typeName="REAL"></variables>
			<variables name="tmpuint" typeName="INT"></variables>
			<variables name="PRM_SCL" typeName="INT"></variables>
			<variables name="STA_SCL" typeName="INT"></variables>
			<variables name="SCALING" typeName="SCALING"></variables>
			<variables name="A_FLTR" typeName="A_FLTR"></variables>
			<variables name="INT_TO_SIGU" typeName="INT_TO_SIGU"></variables>
		</privateLocalVariables>
		<FBProgram name="AIVARFN">
			<STSource>IF PLCCFG.STA_SCN1 THEN
    IF AIVARCFG.CLSID = 0 THEN
        AIVARCFG.CLSID := 16#1030;
    END_IF;
    AIVARCFG.PRM_DSBL := FALSE;
    AIVARCFG.PRM_QALENBL := true;
    AIVARCFG.PRM_BRKENBL := TRUE;
    AIVARCFG.PRM_OVRLENBL := TRUE;
    AIVARCFG.T_PREV := PLCCFG.TQMS;
    IF AIVARCFG.CHID = 0 THEN
        AIVARCFG.CHID := AIVARCFG.CHIDDF;
    END_IF;
    IF CHCFG.ID &gt; 0 THEN
        VRAW := CHCFG.VAL;
    ELSE
        VRAW := 0;
    END_IF;
    AIVARCFG.VALPRV := INT_TO_REAL(VRAW);
    AIVARCFG.VRAW := REAL_TO_INT(AIVARCFG.VALPRV);
    AIVARCFG.VAL := INT_TO_REAL(AIVARCFG.VRAW) ;
    AIVARCFG.T_STEP1 := 0;
    AIVARCFG.STEP1 := 400;
    RETURN;
END_IF;



BRK := AIVARCFG.STA_BRK;
OVRLD := AIVARCFG.STA_OVRLD;
BAD := AIVARCFG.STA_BAD;
ALDIS := AIVARCFG.STA_ALDIS;
ENBL := AIVARCFG.STA_ENBL;
ALM := AIVARCFG.STA_ALM;
LOLO := AIVARCFG.STA_LOLO;
LO := AIVARCFG.STA_LO;
HI := AIVARCFG.STA_HI;
HIHI := AIVARCFG.STA_HIHI;
WRN := AIVARCFG.STA_WRN;
FRC := AIVARCFG.STA_FRC;
SML := AIVARCFG.STA_SML;
INBUF := (AIVARCFG.ID = VARBUF.ID) AND (AIVARCFG.CLSID = VARBUF.CLSID);
CMDLOAD := AIVARHMI.STA.15;
DLNK := (CHCFG.ID &gt; 0);
VARENBL := NOT AIVARCFG.PRM_DSBL AND DLNK;

(*переводимо в реальні одиниці з урахуванням масштабування при необхідності*)
LORAW := AIVARCFG.LORAW;
HIRAW := AIVARCFG.HIRAW;
LOENG := AIVARCFG.LOENG;
HIENG := AIVARCFG.HIENG;
LOSP := AIVARCFG.LOSP;
HISP := AIVARCFG.HISP;
LOLOSP := AIVARCFG.LOLOSP;
HIHISP := AIVARCFG.HIHISP;
 IF AIVARCFG.T_FLT &lt;= 0 THEN
   AIVARCFG.T_FLT := 1;
 END_IF;
T_FLT := UINT_TO_UDINT(AIVARCFG.T_FLT);
T_DEALL := UINT_TO_UDINT(AIVARCFG.T_DEALL*100);
T_DEAL := UINT_TO_UDINT(AIVARCFG.T_DEAL*100);
T_DEAH := UINT_TO_UDINT(AIVARCFG.T_DEAH*100);
T_DEAHH := UINT_TO_UDINT(AIVARCFG.T_DEAHH*100);

(*ping-pong*)
IF DLNK THEN
    CHCFG.STA_PNG := true;
    CHCFG.VARID := AIVARCFG.ID;
END_IF;

    dT1 := PLCCFG.TQMS - AIVARCFG.T_PREV;
    CMD := 0;
    VRAW := CHCFG.VAL;
    T_STEPMS := AIVARCFG.T_STEP1;
    VAL := AIVARCFG.VAL;
    VALPRV := AIVARCFG.VALPRV;
    IF VALPRV &lt;= AIVARCFG.LOENG THEN 
        VALPRV:=AIVARCFG.LOENG;
    ELSIF VALPRV&gt;AIVARCFG.HIENG THEN 
        VALPRV:=AIVARCFG.HIENG; 
    END_IF;
    (*перевірка NaN*)
    IF NOT (VALPRV&lt;AIVARCFG.LOENG OR VALPRV&gt;=AIVARCFG.LOENG) THEN 
        VALPRV:=AIVARCFG.LOENG;
    END_IF;
    (*1% від шкали*)
    VAL1PROC := (AIVARCFG.HIENG - AIVARCFG.LOENG) / 100.0; (* 1 % EU*)
    IF VAL1PROC = 0.0 THEN
        VAL1PROC := 1.0;
    END_IF;
    (*гістерезис в залежності від параметра вказівки гістерезису*)
    IF AIVARCFG.PRM_PARAISPROC THEN (*%*)
        HYST := AIVARCFG.HYST * VAL1PROC;
    ELSE (*real units*)
        HYST := AIVARCFG.HYST;
    END_IF;
    (*перевірка на коректність діапазонів*)
    IF ABS(AIVARCFG.HIRAW - AIVARCFG.LORAW) &lt; 1 THEN
        AIVARCFG.LORAW := 0;
        AIVARCFG.HIRAW := 10000;
    END_IF;
    IF ABS(AIVARCFG.HIENG - AIVARCFG.LOENG) &lt; 0.00001 THEN
        AIVARCFG.LOENG := 0.0;
        AIVARCFG.HIENG := 100.0;
    END_IF;

    (*обнулення некоректних значень + infinity (INF)  - infinity (-INF)  SNAN QNAN *)
    (*коли експонента (23-30 біти) = 255 *)
    tmpDWORD := SHR(IN := REAL_TO_DWORD(AIVARCFG.VAL), N := 23) AND 16#00FF;
    IF tmpDWORD = 16#00ff THEN
        AIVARCFG.VAL := 0.0;
    END_IF;
    (*масштабування*)
    PRM_SCL:=0;STA_SCL:=0;
    PRM_SCL.0 := AIVARCFG.PRM_SQRT;(*квадратнокоренева залежність, X0  *)
    PRM_SCL.1 := true; (*обмежувати вихідну величину, X1*)
    SCALING (IN := INT_TO_REAL(VRAW),
         in_min := INT_TO_REAL(LORAW),
         in_max := INT_TO_REAL(HIRAW),
         out_min := LOENG,
         out_max := HIENG,
         STA := STA_SCL,
         PRM := PRM_SCL,
         SCALING =&gt; VALNOFLT);
    (* якщо відсічка нуля активна(більше нуля) і значення менше то значення нуль, інакше маштабуєм значення*)
    IF AIVARCFG.ZERO_CUT_VAL &gt; 0.0 AND (LOENG + INT_TO_REAL(VRAW - LORAW) * (HIENG - LOENG) / INT_TO_REAL(HIRAW - LORAW)) &lt;= AIVARCFG.ZERO_CUT_VAL THEN
        VALNOFLT := 0.0;
    END_IF;

    (*фільтрація*)
    A_FLTR (IN := VALNOFLT,
        dT1 := dT1,
        T_FLT := T_FLT,
        PRM := tmpuint,
        STA := tmpuint,
        VALPRV := VALPRV,
        A_FLTR =&gt; VAL);
 
     (* широкомовне дефорсування*) 
    IF PLCCFG.CMD = 16#4302 THEN
        FRC := false; (*дефорсувати об'єкт типу*)
    END_IF;

    IF CMDLOAD THEN
        CMD := 16#0100;
    ELSIF INBUF AND VARBUF.CMD &lt;&gt; 0 THEN
        CMD := VARBUF.CMD;
    END_IF;

    CASE CMD OF
        16#0001: (*записати максимум діапазону*)
            IF FRC AND INBUF THEN
                AIVARCFG.VALFRC := AIVARCFG.HIENG;
                VAL := AIVARCFG.HIENG;
                AIVARCFG.STEP1 := 400;
                AIVARCFG.T_STEP1 := 0;
            END_IF;
        16#0002: (*записати мінімум діапазону*)
            IF FRC AND INBUF THEN
                AIVARCFG.VALFRC := AIVARCFG.LOENG;
                VAL := AIVARCFG.LOENG;
                AIVARCFG.STEP1 := 400;
                AIVARCFG.T_STEP1 := 0;
            END_IF;
        16#0003: (*записати середину діапазону*)
            IF FRC AND INBUF THEN
                AIVARCFG.VALFRC := (AIVARCFG.HIENG - AIVARCFG.LOENG) / 2.0;
                VAL := (AIVARCFG.HIENG - AIVARCFG.LOENG) / 2.0;
                AIVARCFG.STEP1 := 400;
                AIVARCFG.T_STEP1 := 0;
            END_IF;
        16#0100: (*прочитати конфігурацію 256*)
            VARBUF.MSG := 201; 
            VARBUF.PRM.0 := AIVARCFG.PRM_LOENBL;
            VARBUF.PRM.1 := AIVARCFG.PRM_HIENBL;
            VARBUF.PRM.2 := AIVARCFG.PRM_LOLOENBL;
            VARBUF.PRM.3 := AIVARCFG.PRM_HIHIENBL;
            VARBUF.PRM.4 := AIVARCFG.PRM_BRKENBL;
            VARBUF.PRM.5 := AIVARCFG.PRM_OVRLENBL;
            VARBUF.PRM.6 := AIVARCFG.PRM_QALENBL;
            VARBUF.PRM.7 := AIVARCFG.PRM_DSBL;
            VARBUF.PRM.8 := AIVARCFG.PRM_PWLENBL;
            VARBUF.PRM.9 := AIVARCFG.PRM_TOTALON;
            VARBUF.PRM.10 := AIVARCFG.PRM_SQRT;
            VARBUF.PRM.11 := AIVARCFG.PRM_PARAISPROC;
            VARBUF.PRM.12 := AIVARCFG.PRM_AFRZENBL;        
            VARBUF.PRM.13 := AIVARCFG.PRM_ASPDENBL;
            VARBUF.PRM.14 := AIVARCFG.PRM_b14;
            VARBUF.PRM.15 := AIVARCFG.PRM_b15;
    
            VARBUF.ID := AIVARCFG.ID;
            VARBUF.CLSID := AIVARCFG.CLSID;
            VARBUF.CHID := AIVARCFG.CHID;
            VARBUF.VALR := AIVARCFG.VALFRC;
            
            VARBUF.LORAW := AIVARCFG.LORAW;
            VARBUF.HIRAW := AIVARCFG.HIRAW;
            VARBUF.LOENG := AIVARCFG.LOENG;
            VARBUF.HIENG := AIVARCFG.HIENG;
            VARBUF.HIHISP := AIVARCFG.HIHISP;
            VARBUF.HISP := AIVARCFG.HISP;
            VARBUF.LOSP := AIVARCFG.LOSP;
            VARBUF.LOLOSP := AIVARCFG.LOLOSP;
            VARBUF.T_FLTSP := AIVARCFG.T_FLT;
            VARBUF.HYST := AIVARCFG.HYST;
            VARBUF.T_DEAHH := AIVARCFG.T_DEAHH;
            VARBUF.T_DEAH := AIVARCFG.T_DEAH;
            VARBUF.T_DEAL := AIVARCFG.T_DEAL;
            VARBUF.T_DEALL := AIVARCFG.T_DEALL;
            
            VARBUF.VALPRV_AFRZ :=AIVARCFG.VALPRV_AFRZ;
            VARBUF.VALPRV_ASPD :=AIVARCFG.VALPRV_ASPD;
            VARBUF.DEASP_AFRZ :=AIVARCFG.DEASP_AFRZ;
            VARBUF.DOPSP_ASPD := AIVARCFG.DOPSP_ASPD;
            VARBUF.ZERO_CUT_VAL := AIVARCFG.ZERO_CUT_VAL;
            
        16#0101: (*записати конфігурацію 257*)
            (* MSG 200-Ok 400-Error
            // 200 - Дані записані
            // 201 - Дані прочитані 
            // 403 - канал вже зайнятий 
            // 404 - номер каналу не відповідає діапазону   *)
    
            AIVARCFG.PRM_LOENBL := VARBUF.PRM.0;
            AIVARCFG.PRM_HIENBL := VARBUF.PRM.1;
            AIVARCFG.PRM_LOLOENBL := VARBUF.PRM.2;
            AIVARCFG.PRM_HIHIENBL := VARBUF.PRM.3;
            AIVARCFG.PRM_BRKENBL := VARBUF.PRM.4;
            AIVARCFG.PRM_OVRLENBL := VARBUF.PRM.5;
            AIVARCFG.PRM_QALENBL := VARBUF.PRM.6;
            AIVARCFG.PRM_DSBL := VARBUF.PRM.7;
            AIVARCFG.PRM_PWLENBL := VARBUF.PRM.8;
            AIVARCFG.PRM_TOTALON := VARBUF.PRM.9;
            AIVARCFG.PRM_SQRT := VARBUF.PRM.10;
            AIVARCFG.PRM_PARAISPROC := VARBUF.PRM.11;
            AIVARCFG.PRM_AFRZENBL := VARBUF.PRM.12;
            AIVARCFG.PRM_ASPDENBL := VARBUF.PRM.13;
            AIVARCFG.PRM_b14 := VARBUF.PRM.14;
            AIVARCFG.PRM_b15 := VARBUF.PRM.15;
    
            AIVARCFG.LORAW := VARBUF.LORAW;
            AIVARCFG.HIRAW := VARBUF.HIRAW;
            AIVARCFG.LOENG := VARBUF.LOENG;
            AIVARCFG.HIENG := VARBUF.HIENG;
            AIVARCFG.HIHISP := VARBUF.HIHISP;
            AIVARCFG.HISP := VARBUF.HISP;
            AIVARCFG.LOSP := VARBUF.LOSP;
            AIVARCFG.LOLOSP := VARBUF.LOLOSP;
            AIVARCFG.T_FLT := VARBUF.T_FLTSP;
            AIVARCFG.HYST := VARBUF.HYST;
            AIVARCFG.T_DEAHH := VARBUF.T_DEAHH;
            AIVARCFG.T_DEAH := VARBUF.T_DEAH;
            AIVARCFG.T_DEAL := VARBUF.T_DEAL;
            AIVARCFG.T_DEALL := VARBUF.T_DEALL;
     
            AIVARCFG.VALPRV_AFRZ := VARBUF.VALPRV_AFRZ ;
            AIVARCFG.VALPRV_ASPD := VARBUF.VALPRV_ASPD ;
            AIVARCFG.DEASP_AFRZ := VARBUF.DEASP_AFRZ ;
            AIVARCFG.DOPSP_ASPD :=  VARBUF.DOPSP_ASPD ;
            AIVARCFG.ZERO_CUT_VAL := VARBUF.ZERO_CUT_VAL  ;       
            
            (*зміна 27.10.2021 Пупена*)
            VARBUF.MSG:=200; 
            IF VARBUF.CHID&gt;=0 AND VARBUF.CHID &lt;= INT_TO_UINT(PLCCFG.AICNT) THEN
                IF CHAI[VARBUF.CHID].VARID = 0 THEN 
                    AIVARCFG.CHID := VARBUF.CHID;
                ELSIF VARBUF.CHID &lt;&gt; AIVARCFG.CHID THEN 
                    VARBUF.MSG := 403;(* канал вже зайнятий*)
                END_IF;
            ELSE 
                VARBUF.MSG := 404; (*номер каналу не відповідає діапазону*)
            END_IF;
            IF INBUF THEN
                VARBUF.CHID := AIVARCFG.CHID;
            END_IF;
            
        16#0102: (*записати значення за замовченням*)
            AIVARCFG.CHID := AIVARCFG.CHIDDF;
        16#0160: (*інвертувати LOENBL*)
            AIVARCFG.PRM_LOENBL := NOT AIVARCFG.PRM_LOENBL;
        16#0161: (*інвертувати HIENBL*)
            AIVARCFG.PRM_HIENBL := NOT AIVARCFG.PRM_HIENBL;
        16#0162: (*інвертувати LOLOENBL*)
            AIVARCFG.PRM_LOLOENBL := NOT AIVARCFG.PRM_LOLOENBL;
        16#0163: (*інвертувати HIHIENBL*)
            AIVARCFG.PRM_HIHIENBL := NOT AIVARCFG.PRM_HIHIENBL;
        16#0300: (*перемкнути форсування*)
            FRC := NOT FRC;
        16#0301: (*форсувати один/усі об'єкти типу*)
            FRC := true;
        16#0302: (*дефорсувати один/усі об'єкти типу*)
            FRC := false;
        16#0311: (* імітувати*)
            SML := true;
        16#0312: (* зняти режим імітації*)
            SML := false;
    END_CASE;


IF FRC THEN
    IF INBUF THEN
        AIVARCFG.VAL := VARBUF.VALR;
        AIVARCFG.VALFRC := VARBUF.VALR;
    END_IF;
    VAL := AIVARCFG.VALFRC;(*змінив на VALI 5.11.21*)
ELSIF SML THEN (* режим симуляції - значення змінюється ззовні *)
    VAL := AIVARCFG.VAL;
ELSE  
    AIVARCFG.VALFRC := VAL; 
END_IF;



    (*обробка тривог*)
BRK := false;
LO := false;
LOLO := false;
HI := false;
HIHI := false;
OVRLD := false;
T_DEAQALSP := 10;     (* час затримки на виникнення тривог обривів і кз в 0.1 с*)
    
    (*варто VAL замість VARCFG.VAL примітка 29.08 *)
    (*не алармувати*)
    IF VARENBL THEN (*тільки при активності змінної обробляються тривоги*)
        (*перевірка на спрацювання*)
        tmpOVRLD := CHCFG.VAL&gt;=11000;(*виправлено Міркевич, пізніше обговорити(VALNOFLT &gt; (AIVARCFG.HIENG + VAL1PROC * 0.5) AND CHCFG.VAL &lt;&gt; 32767) AND NOT FRC;*)
        tmpBRK := CHCFG.VAL&lt;=-1000;  (*виправлено Міркевич (VALNOFLT &lt; (AIVARCFG.LOENG - VAL1PROC * 0.5) OR CHCFG.VAL = 32767) AND NOT FRC;*)
        tmpHI := (VAL &gt;= AIVARCFG.HISP);
        tmpHIHI := (VAL &gt;= AIVARCFG.HIHISP);
        tmpLO := (VAL &lt;= AIVARCFG.LOSP);
        tmpLOLO := (VAL &lt;= AIVARCFG.LOLOSP);
        (*якщо активована перевірка якості то PRM_BRKENBL та PRM_OVRLENBL ставимо насильно*)
        IF NOT AIVARCFG.PRM_QALENBL THEN
            AIVARCFG.PRM_BRKENBL := false;
            AIVARCFG.PRM_OVRLENBL := false;
        END_IF;
        
        CASE AIVARCFG.STEP1 OF
            100:  (*BRK - обрив каналу*)
                LO := AIVARCFG.PRM_LOENBL;
                LOLO := AIVARCFG.PRM_LOLOENBL;
                IF NOT tmpBRK OR NOT AIVARCFG.PRM_BRKENBL THEN (*вихід із зони*)
                    AIVARCFG.STEP1 := 200;
                    (*AIVARCFG.T_STEP1 := 0;*)
                ELSIF T_STEPMS &gt;= INT_TO_UDINT(T_DEAQALSP) THEN (*тривога*)
                    BRK := true;
                END_IF;
            200: (*LOLO*)
                LO := AIVARCFG.PRM_LOENBL;
                LOLO := AIVARCFG.PRM_LOLOENBL AND T_STEPMS &gt;= UINT_TO_UDINT(AIVARCFG.T_DEALL);
                IF NOT LOLO AND NOT tmpLOLO
                    OR NOT AIVARCFG.PRM_LOLOENBL
                    OR AIVARCFG.VAL &gt; (AIVARCFG.LOLOSP + HYST) THEN (*вихід із зони*)
                    AIVARCFG.STEP1 := 300;
                    (*AIVARCFG.T_STEP1 := 0;*)
                END_IF;
                IF LOLO AND tmpBRK AND AIVARCFG.PRM_BRKENBL THEN
                    AIVARCFG.STEP1 := 100;
                    AIVARCFG.T_STEP1 := 0;
                END_IF;
            300: (*LO*)
                LO := AIVARCFG.PRM_LOENBL AND T_STEPMS &gt;= UINT_TO_UDINT(AIVARCFG.T_DEAL);
                IF (NOT tmpLO AND NOT LO OR NOT AIVARCFG.PRM_LOENBL)   (*вихід із зони*)
                    OR AIVARCFG.VAL &gt; (AIVARCFG.LOSP + HYST) THEN
                    AIVARCFG.STEP1 := 400;
                    AIVARCFG.T_STEP1 := 0;
                END_IF;
                IF LO AND tmpLOLO AND AIVARCFG.PRM_LOLOENBL THEN
                    AIVARCFG.STEP1 := 200;
                    AIVARCFG.T_STEP1 := 0;
                END_IF;
                IF LO AND tmpBRK AND AIVARCFG.PRM_BRKENBL THEN
                    AIVARCFG.STEP1 := 100;
                    AIVARCFG.T_STEP1 := 0;
                END_IF;
            400: (*norma*)
                IF tmpHI AND AIVARCFG.PRM_HIENBL THEN
                    AIVARCFG.STEP1 := 500;
                    AIVARCFG.T_STEP1 := 0;
                END_IF;
                IF tmpLO AND AIVARCFG.PRM_LOENBL THEN
                    AIVARCFG.STEP1 := 300;
                    AIVARCFG.T_STEP1 := 0;
                END_IF;
                IF tmpHIHI AND AIVARCFG.PRM_HIHIENBL THEN
                    AIVARCFG.STEP1 := 460;
                    AIVARCFG.T_STEP1 := 0;
                END_IF;
                IF tmpLOLO AND AIVARCFG.PRM_LOLOENBL THEN
                    AIVARCFG.STEP1 := 420;
                    AIVARCFG.T_STEP1 := 0;
                END_IF;
                IF tmpBRK AND AIVARCFG.PRM_BRKENBL THEN
                    AIVARCFG.STEP1 := 410;
                    AIVARCFG.T_STEP1 := 0;
                END_IF;
                IF tmpOVRLD AND AIVARCFG.PRM_OVRLENBL THEN
                    AIVARCFG.STEP1 := 470;
                    AIVARCFG.T_STEP1 := 0;
                END_IF;
            410: (*norma -&gt; break*)
                IF NOT tmpBRK OR NOT AIVARCFG.PRM_BRKENBL THEN (*вихід із зони*)
                    AIVARCFG.STEP1 := 400;
                    AIVARCFG.T_STEP1 := 0;
                ELSIF T_STEPMS &gt;= INT_TO_UDINT(T_DEAQALSP) THEN (*тривога*)
                    AIVARCFG.STEP1 := 100;
                END_IF;
            420: (*norma -&gt; LOLO*)
                IF NOT tmpLOLO OR NOT AIVARCFG.PRM_LOLOENBL THEN (*вихід із зони*)
                    AIVARCFG.STEP1 := 400;
                    AIVARCFG.T_STEP1 := 0;
                ELSIF T_STEPMS &gt;= UINT_TO_UDINT(AIVARCFG.T_DEALL) THEN (*тривога*)
                    AIVARCFG.STEP1 := 200;
                END_IF;
            460: (*norma -&gt; HIHI*)
                IF NOT tmpHIHI OR NOT AIVARCFG.PRM_HIHIENBL THEN (*вихід із зони*)
                    AIVARCFG.STEP1 := 400;
                    AIVARCFG.T_STEP1 := 0;
                ELSIF T_STEPMS &gt;= UINT_TO_UDINT(AIVARCFG.T_DEAHH) THEN (*тривога*)
                    AIVARCFG.STEP1 := 600;
                END_IF;
            470: (*norma -&gt; OVRLD*)
                IF NOT tmpOVRLD OR NOT AIVARCFG.PRM_OVRLENBL THEN (*вихід із зони*)
                    AIVARCFG.STEP1 := 400;
                    AIVARCFG.T_STEP1 := 0;
                ELSIF T_STEPMS &gt;= INT_TO_UDINT(T_DEAQALSP) THEN (*тривога*)
                    AIVARCFG.STEP1 := 700;
                END_IF;
            500: (*HI*)
                HI := AIVARCFG.PRM_HIENBL AND T_STEPMS &gt;= UINT_TO_UDINT(AIVARCFG.T_DEAH);
                IF NOT tmpHI AND NOT HI
                    OR NOT AIVARCFG.PRM_HIENBL (*вихід із зони*)
                    OR AIVARCFG.VAL &lt; (AIVARCFG.HISP - HYST) THEN
                    AIVARCFG.STEP1 := 400;
                    AIVARCFG.T_STEP1 := 0;
                END_IF;
                IF HI AND tmpHIHI AND AIVARCFG.PRM_HIHIENBL THEN
                    AIVARCFG.STEP1 := 600;
                    AIVARCFG.T_STEP1 := 0;
                END_IF;
                IF HI AND tmpOVRLD AND AIVARCFG.PRM_OVRLENBL THEN
                    AIVARCFG.STEP1 := 700;
                    AIVARCFG.T_STEP1 := 0;
                END_IF;
            600: (*HIHI*)
                HI := AIVARCFG.PRM_HIENBL;
                HIHI := AIVARCFG.PRM_HIHIENBL AND T_STEPMS &gt;= UINT_TO_UDINT(AIVARCFG.T_DEAHH);
                IF NOT tmpHIHI AND NOT HIHI OR
                    NOT AIVARCFG.PRM_HIHIENBL OR
                    AIVARCFG.VAL &lt; (AIVARCFG.HIHISP - HYST) THEN (*вихід із зони*)
                    AIVARCFG.STEP1 := 500;
                    (*AIVARCFG.T_STEP1 := 0;*)
                END_IF;
                IF HI AND tmpOVRLD AND AIVARCFG.PRM_OVRLENBL THEN
                    AIVARCFG.STEP1 := 700;
                    AIVARCFG.T_STEP1 := 0;
                END_IF;
            700: (*OVRLD - перегурзка/КЗ*)
                HI := AIVARCFG.PRM_HIENBL;
                HIHI := AIVARCFG.PRM_HIHIENBL;
                IF (NOT tmpOVRLD OR NOT AIVARCFG.PRM_OVRLENBL) THEN (*вихід із зони*)
                    AIVARCFG.STEP1 := 600;
                    (*AIVARCFG.T_STEP1 := 0;*)
                ELSIF T_STEPMS &gt;= INT_TO_UDINT(T_DEAQALSP) THEN (*тривога*)
                    OVRLD := true;
                END_IF;
            ELSE
                AIVARCFG.STEP1 := 400;
        END_CASE;
    ELSE 
        AIVARCFG.VRAW := VRAW;
        AIVARCFG.VAL := VALNOFLT;
        AIVARCFG.T_STEP1 := 0;
        AIVARCFG.STEP1 := 400;
        BAD := false;
        BRK := false;
        LO := false;
        LOLO := false;
        HI := false;
        HIHI := false;
        OVRLD := false;
        ENBL := false;
    END_IF;

    (*-------- не є частиною каркасу, кастом для Енікон*)
    IF PLCCFG.STA_SCN1 THEN
       AIVARCFG.VALPRV_AFRZ := VAL;
       AIVARCFG.VALPRV_ASPD := VAL;
    END_IF;
    (* Перевірка на зависання *)
    (*протягом 20 сек значення повинно змінитися більш ніж на задану уставку у од.вимір якщо уставка 0 - по дефолту*)
    IF AIVARCFG.PRM_AFRZENBL THEN
        tmpAFRZ:=AIVARCFG.STA2_AFRZ;
        (*перевіряти на кожній 20 сек на один цикл*)
        IF (PLCCFG.TQ MOD 20) = 0 AND PLCCFG.PLS_P1S THEN
            IF ABS(AIVARCFG.VALPRV_AFRZ - VAL) &lt; AIVARCFG.DEASP_AFRZ THEN
                tmpAFRZ:=true;
            ELSE 
                tmpAFRZ:=false; (*самоскидання*)
            END_IF; 
            AIVARCFG.VALPRV_AFRZ := VAL;
        END_IF;
        (*якщо значення зміниться у будь який час оновити його (відкидання помилки випадкової рівності через вказаний час)  *)
        IF  ABS(VAL - AIVARCFG.VALPRV) &gt; AIVARCFG.DEASP_AFRZ THEN
            AIVARCFG.VALPRV_AFRZ := VAL;
        END_IF; 
        AIVARCFG.STA2_AFRZ := tmpAFRZ;
    END_IF;
    (* Перевірка на скачок *)
    IF AIVARCFG.PRM_ASPDENBL THEN 
        (* аларм швидкості зміни, якщо через заданий час значення скочило більше ніж допуск - помилка WRN*)
        tmpASPD:=false;
        AIVARCFG.STA2_ASPD := tmpASPD;
        (*перевіряти на кожній 5 сек на один цикл*)
        IF (PLCCFG.TQ MOD 5) = 0 AND PLCCFG.PLS_P1S THEN
            IF ABS(AIVARCFG.VALPRV_ASPD - VAL) &gt; AIVARCFG.DOPSP_ASPD THEN
                tmpASPD:=true;
            ELSE 
                tmpASPD:=false; (*самоскидання*)
            END_IF; 
            AIVARCFG.VALPRV_ASPD := VAL;
        END_IF;

	AIVARCFG.STA2_AOVRFL:=VRAW&gt;10100 AND VRAW&lt;10999;
        AIVARCFG.STA2_AUNDRFL:=VRAW&lt;-100 AND VRAW&gt;-999;
        tmpAOVRFL:=AIVARCFG.STA2_AOVRFL;
        tmpAUNDRFL:=AIVARCFG.STA2_AUNDRFL;
    END_IF;
    (*------------------------*)
    BAD := (CHCFG.STA_BAD OR BRK OR OVRLD OR tmpAOVRFL OR tmpAUNDRFL OR tmpAFRZ) AND AIVARCFG.PRM_QALENBL AND VARENBL AND NOT SML AND NOT FRC;
    ALM := (LOLO OR HIHI) AND NOT BAD;
    WRN := (LO OR HI OR tmpASPD) AND NOT ALM AND NOT BAD;

    IF BAD THEN
        PLCCFG.ALM_BAD := true;
        PLCCFG.CNTBAD := PLCCFG.CNTBAD + 1;
        IF NOT AIVARCFG.STA_BAD THEN
            PLCCFG.ALM_NWBAD := true;
        END_IF;
    END_IF;
    IF ALM THEN
        PLCCFG.ALM_ALM := true;
        PLCCFG.CNTALM := PLCCFG.CNTALM + 1;
        IF NOT AIVARCFG.STA_ALM THEN
            PLCCFG.ALM_NWALM := true;
        END_IF;
    END_IF;
    IF WRN THEN
        PLCCFG.ALM_WRN := true;
        PLCCFG.CNTWRN := PLCCFG.CNTWRN + 1;
        IF NOT AIVARCFG.STA_WRN THEN
            PLCCFG.ALM_NWWRN := true;
        END_IF;
    END_IF;
    IF FRC THEN
        PLCCFG.STA_FRC1 := true;
        PLCCFG.CNTFRC := PLCCFG.CNTFRC + 1;
    END_IF;
    IF SML THEN
        PLCCFG.STA_SML := true;
    END_IF;

AIVARCFG.STA_BRK := BRK;
AIVARCFG.STA_OVRLD := OVRLD;
AIVARCFG.STA_BAD := BAD;
AIVARCFG.STA_ALDIS := ALDIS;
AIVARCFG.STA_DLNK := DLNK;
AIVARCFG.STA_ENBL := VARENBL;
AIVARCFG.STA_ALM := ALM;
AIVARCFG.STA_LOLO := LOLO;
AIVARCFG.STA_LO := LO;
AIVARCFG.STA_HI := HI;
AIVARCFG.STA_HIHI := HIHI;
AIVARCFG.STA_WRN := WRN;
AIVARCFG.STA_INBUF := INBUF;
AIVARCFG.STA_FRC := FRC;
AIVARCFG.STA_SML := SML;
AIVARCFG.STA_CMDLOAD := FALSE;

    (*у %    *)
    VALPROC := (VAL - AIVARCFG.LOENG) / VAL1PROC;
    IF VALPROC &lt; 0.0 THEN
        VALPROC := 0.0;
    END_IF;
    IF VALPROC &gt; 100.0 THEN
        VALPROC := 100.0;
    END_IF;

    AIVARCFG.VAL := VAL;
    AIVARCFG.VRAW := VRAW;
    AIVARCFG.VALPRV := VALPRV;
    (* зміна 27.08 VALPROC: старший байт вміщує значення від 0-100%, молодший - біти STA2*)
    (* може бути частиною каркасу при необхідності статусних бітів і ларамів &gt;15*)
    AIVARCFG.VALPRCSTA2 := REAL_TO_INT(VALPROC)*256 AND 16#FF00;
    AIVARCFG.VALPRCSTA2.0 := AIVARCFG.STA2_ASPD;
    AIVARCFG.VALPRCSTA2.1 := AIVARCFG.STA2_AFRZ;
    AIVARCFG.VALPRCSTA2.2 := AIVARCFG.STA2_AOVRFL;
    AIVARCFG.VALPRCSTA2.3 := AIVARCFG.STA2_AUNDRFL;
    AIVARCFG.T_PREV := PLCCFG.TQMS;
    AIVARCFG.T_STEP1 := AIVARCFG.T_STEP1 + dT1;

    AIVARHMI.STA := AIVARCFG.STA;
    AIVARHMI.VAL := VAL;
    AIVARHMI.VALPRCSTA2 := AIVARCFG.VALPRCSTA2;


IF AIVARCFG.T_STEP1 &gt; 16#7FFF_FFFF THEN
    AIVARCFG.T_STEP1 := 16#7FFF_FFFF;
END_IF;

IF INBUF THEN
    VARBUF.CMD := 0;
    VARBUF.VALR := AIVARCFG.VAL;
    VARBUF.STA := AIVARCFG.STA;
    VARBUF.VRAWR := INT_TO_REAL(VRAW);
    IF NOT FRC THEN
        VARBUF.VALR := VAL;
    END_IF;
    VARBUF.STEP1 := AIVARCFG.STEP1;
    VARBUF.T_STEP1 := AIVARCFG.T_STEP1;
    VARBUF.VALPROC := AIVARCFG.VALPRCSTA2;
    VARBUF.LOLOSP_PRC := REAL_TO_INT(AIVARCFG.LOLOSP / VAL1PROC * 100.0);
    VARBUF.LOSP_PRC := REAL_TO_INT(AIVARCFG.LOSP / VAL1PROC * 100.0);
    VARBUF.HISP_PRC := REAL_TO_INT(AIVARCFG.HISP / VAL1PROC * 100.0);
    VARBUF.HIHISP_PRC := REAL_TO_INT(AIVARCFG.HIHISP / VAL1PROC * 100.0);

    VARBUF.CH_CLSID := CHCFG.CLSID;
    VARBUF.CH_STA.0 := CHCFG.STA_VRAW;
    VARBUF.CH_STA.1 := CHCFG.STA_VALB;
    VARBUF.CH_STA.2 := CHCFG.STA_BAD;
    VARBUF.CH_STA.3 := CHCFG.STA_b3;
    VARBUF.CH_STA.4 := CHCFG.STA_PNG;
    VARBUF.CH_STA.5 := CHCFG.STA_ULNK;
    VARBUF.CH_STA.6 := CHCFG.STA_MERR;
    VARBUF.CH_STA.7 := CHCFG.STA_BRK;
    VARBUF.CH_STA.8 := CHCFG.STA_SHRT;
    VARBUF.CH_STA.9 := CHCFG.STA_NBD;
    VARBUF.CH_STA.10 := CHCFG.STA_b10;
    VARBUF.CH_STA.11 := CHCFG.STA_INIOTBUF;
    VARBUF.CH_STA.12 := CHCFG.STA_INBUF;
    VARBUF.CH_STA.13 := CHCFG.STA_FRC;
    VARBUF.CH_STA.14 := CHCFG.STA_SML;
    VARBUF.CH_STA.15 := CHCFG.STA_CMDLOAD;

    INT_TO_SIGU (CLSID := CHCFG.CLSID,
             	 VALINT := VRAW,
                 INT_TO_SIGU =&gt; VARBUF.CH_VALSIG);
    
END_IF;


</STSource>
		</FBProgram>
	</FBSource>
	<DDTSource DDTName="CH_CFG" version="0.03" dateTime="dt#2022-01-14-11:13:50">
		<attribute name="TypeSignatureCheckSumString" value="7228"></attribute>
		<structure>
			<variables name="ID" typeName="UINT">
				<comment>Унікальний ідентифікатор</comment>
			</variables>
			<variables name="CLSID" typeName="UINT">
				<comment>ідентифікатор класу</comment>
			</variables>
			<variables name="STA" typeName="INT"></variables>
			<variables name="STA_VRAW" typeName="BOOL">
				<comment>=1 – значення дискретного сигналу з дискретного входу</comment>
				<attribute name="ExtractBit" value="0"></attribute>
			</variables>
			<variables name="STA_VALB" typeName="BOOL">
				<comment>=1 – значення дискретного сигналу для CM верхнього рівня, в режимі FRC=1 може змінюватися із-зовні</comment>
				<attribute name="ExtractBit" value="1"></attribute>
			</variables>
			<variables name="STA_BAD" typeName="BOOL">
				<comment>=1 – є помилка каналу</comment>
				<attribute name="ExtractBit" value="2"></attribute>
			</variables>
			<variables name="STA_b3" typeName="BOOL">
				<attribute name="ExtractBit" value="3"></attribute>
			</variables>
			<variables name="STA_PNG" typeName="BOOL">
				<comment>=1 прийшла відповідь від володаря, обнуляється каналом</comment>
				<attribute name="ExtractBit" value="4"></attribute>
			</variables>
			<variables name="STA_ULNK" typeName="BOOL">
				<comment>=1 – якщо використовується в змінній DIVAR/AIVAR/DOVAR/AOVAR</comment>
				<attribute name="ExtractBit" value="5"></attribute>
			</variables>
			<variables name="STA_MERR" typeName="BOOL">
				<comment>=1 – є помилка модулю (діагностична інформація)</comment>
				<attribute name="ExtractBit" value="6"></attribute>
			</variables>
			<variables name="STA_BRK" typeName="BOOL">
				<comment>=1 – помилка обриву каналу</comment>
				<attribute name="ExtractBit" value="7"></attribute>
			</variables>
			<variables name="STA_SHRT" typeName="BOOL">
				<comment>=1 – помилка КЗ</comment>
				<attribute name="ExtractBit" value="8"></attribute>
			</variables>
			<variables name="STA_NBD" typeName="BOOL">
				<comment>=1 – фізично канал не існує; наприклад, для відображення в буфері модуля MODULS, для використання резерву каналів не прив’язаних до фізичних</comment>
				<attribute name="ExtractBit" value="9"></attribute>
			</variables>
			<variables name="STA_b10" typeName="BOOL">
				<attribute name="ExtractBit" value="10"></attribute>
			</variables>
			<variables name="STA_INIOTBUF" typeName="BOOL">
				<comment>=1 - в буфері IoT </comment>
				<attribute name="ExtractBit" value="11"></attribute>
			</variables>
			<variables name="STA_INBUF" typeName="BOOL">
				<comment>=1 – в буфері</comment>
				<attribute name="ExtractBit" value="12"></attribute>
			</variables>
			<variables name="STA_FRC" typeName="BOOL">
				<comment>=1 – значення форсоване</comment>
				<attribute name="ExtractBit" value="13"></attribute>
			</variables>
			<variables name="STA_SML" typeName="BOOL">
				<comment>=1 – значення імітується</comment>
				<attribute name="ExtractBit" value="14"></attribute>
			</variables>
			<variables name="STA_CMDLOAD" typeName="BOOL">
				<comment>=1 - запит на зчитування в буфер (тільки з HMI)</comment>
				<attribute name="ExtractBit" value="15"></attribute>
			</variables>
			<variables name="CMD" typeName="INT">
				<comment>командне слово</comment>
			</variables>
			<variables name="VAL" typeName="INT">
				<comment>значення змінної</comment>
			</variables>
			<variables name="VARID" typeName="UINT">
				<comment>ID привязаної змінної</comment>
			</variables>
		</structure>
	</DDTSource>
	<DDTSource DDTName="AIVAR_CFG" version="0.02" dateTime="dt#2022-01-16-20:47:28">
		<attribute name="TypeSignatureCheckSumString" value="DF13"></attribute>
		<structure>
			<variables name="ID" typeName="UINT">
				<comment>Унікальний ідентифікатор</comment>
			</variables>
			<variables name="CLSID" typeName="UINT">
				<comment>16#1030</comment>
			</variables>
			<variables name="STA" typeName="INT">
				<comment>статус (див STC)</comment>
			</variables>
			<variables name="STA_BRK" typeName="BOOL">
				<comment>=1 – Обрив каналу {A.BAD.0}</comment>
				<attribute name="ExtractBit" value="0"></attribute>
			</variables>
			<variables name="STA_OVRLD" typeName="BOOL">
				<comment>=1 – КЗ або перевантаження каналу {A.BAD.1}</comment>
				<attribute name="ExtractBit" value="1"></attribute>
			</variables>
			<variables name="STA_BAD" typeName="BOOL">
				<comment>=1 – Дані недостовірні {A.BAD.2}</comment>
				<attribute name="ExtractBit" value="2"></attribute>
			</variables>
			<variables name="STA_ALDIS" typeName="BOOL">
				<comment>=1 – Тривога виведена з експлуатації {A.MSG.3}</comment>
				<attribute name="ExtractBit" value="3"></attribute>
			</variables>
			<variables name="STA_DLNK" typeName="BOOL">
				<comment>=1 – якщо прив’язаний до каналу</comment>
				<attribute name="ExtractBit" value="4"></attribute>
			</variables>
			<variables name="STA_ENBL" typeName="BOOL">
				<comment>=1 – змінна задіяна = (NOT PRM.7 AND DLNK)</comment>
				<attribute name="ExtractBit" value="5"></attribute>
			</variables>
			<variables name="STA_ALM" typeName="BOOL">
				<comment>=1 – активна технологічна тривога і не активна BAD</comment>
				<attribute name="ExtractBit" value="6"></attribute>
			</variables>
			<variables name="STA_LOLO" typeName="BOOL">
				<comment>=1 – Критично низьке значення {A.ALM.7}</comment>
				<attribute name="ExtractBit" value="7"></attribute>
			</variables>
			<variables name="STA_LO" typeName="BOOL">
				<comment>=1 – Низьке значення {A.WRN.8}</comment>
				<attribute name="ExtractBit" value="8"></attribute>
			</variables>
			<variables name="STA_HI" typeName="BOOL">
				<comment>=1 – Високе значення {A.WRN.9}</comment>
				<attribute name="ExtractBit" value="9"></attribute>
			</variables>
			<variables name="STA_HIHI" typeName="BOOL">
				<comment>=1 – Критично високе значення {A.ALM.10}</comment>
				<attribute name="ExtractBit" value="10"></attribute>
			</variables>
			<variables name="STA_WRN" typeName="BOOL">
				<comment>=1 – активне технологічне попередження і не активні BAD та ALM</comment>
				<attribute name="ExtractBit" value="11"></attribute>
			</variables>
			<variables name="STA_INBUF" typeName="BOOL">
				<comment>=1 – змінна в буфері</comment>
				<attribute name="ExtractBit" value="12"></attribute>
			</variables>
			<variables name="STA_FRC" typeName="BOOL">
				<comment>=1 – Режим форсування{A.MSG.13}</comment>
				<attribute name="ExtractBit" value="13"></attribute>
			</variables>
			<variables name="STA_SML" typeName="BOOL">
				<comment>=1 – змінна в режимі симуляції</comment>
				<attribute name="ExtractBit" value="14"></attribute>
			</variables>
			<variables name="STA_CMDLOAD" typeName="BOOL">
				<comment>=1 – команда завантаження в буфер</comment>
				<attribute name="ExtractBit" value="15"></attribute>
			</variables>
			<variables name="VALPRCSTA2" typeName="INT">
				<comment>значення у % від шкали вимірювання (0-10000)</comment>
			</variables>
			<variables name="PRM" typeName="INT">
				<comment>параметри</comment>
			</variables>
			<variables name="PRM_LOENBL" typeName="BOOL">
				<comment>=1 – задіяна тривога LO /MASK 16#1</comment>
				<attribute name="ExtractBit" value="0"></attribute>
			</variables>
			<variables name="PRM_HIENBL" typeName="BOOL">
				<comment>=1 – задіяна тривога HI /MASK 16#2</comment>
				<attribute name="ExtractBit" value="1"></attribute>
			</variables>
			<variables name="PRM_LOLOENBL" typeName="BOOL">
				<comment>=1 – задіяна тривога LOLO /MASK 16#4</comment>
				<attribute name="ExtractBit" value="2"></attribute>
			</variables>
			<variables name="PRM_HIHIENBL" typeName="BOOL">
				<comment>=1 – задіяна тривога HIHI/MASK 16#8</comment>
				<attribute name="ExtractBit" value="3"></attribute>
			</variables>
			<variables name="PRM_BRKENBL" typeName="BOOL">
				<comment>=1 – задіяна тривога обриву</comment>
				<attribute name="ExtractBit" value="4"></attribute>
			</variables>
			<variables name="PRM_OVRLENBL" typeName="BOOL">
				<comment>=1 – задіяна тривога перевантаження</comment>
				<attribute name="ExtractBit" value="5"></attribute>
			</variables>
			<variables name="PRM_QALENBL" typeName="BOOL">
				<comment>=1 – задіяна тривога перевірки якості даних</comment>
				<attribute name="ExtractBit" value="6"></attribute>
			</variables>
			<variables name="PRM_DSBL" typeName="BOOL">
				<comment>=1 – змінна не задіяна</comment>
				<attribute name="ExtractBit" value="7"></attribute>
			</variables>
			<variables name="PRM_PWLENBL" typeName="BOOL">
				<comment>=1 – задіяна кусочно-лінійна інтерполяція (не використовувати разом з TOTALON)</comment>
				<attribute name="ExtractBit" value="8"></attribute>
			</variables>
			<variables name="PRM_TOTALON" typeName="BOOL">
				<comment>=1 – задіяне інтегрування (не використовувати разом з PWLENBL)</comment>
				<attribute name="ExtractBit" value="9"></attribute>
			</variables>
			<variables name="PRM_SQRT" typeName="BOOL">
				<comment>=1 - задіяне квадратичне (квадратний корінь) масштабування</comment>
				<attribute name="ExtractBit" value="10"></attribute>
			</variables>
			<variables name="PRM_PARAISPROC" typeName="BOOL">
				<comment>=1 - параметри налаштування (гістерезис, нечутл) задається в процентах</comment>
				<attribute name="ExtractBit" value="11"></attribute>
			</variables>
			<variables name="PRM_AFRZENBL" typeName="BOOL">
				<comment>=1 - активна тривога нечутливості контролю зависання</comment>
				<attribute name="ExtractBit" value="12"></attribute>
			</variables>
			<variables name="PRM_ASPDENBL" typeName="BOOL">
				<comment>=1 - активна тривога допуску контролю швидкості</comment>
				<attribute name="ExtractBit" value="13"></attribute>
			</variables>
			<variables name="PRM_b14" typeName="BOOL">
				<attribute name="ExtractBit" value="14"></attribute>
			</variables>
			<variables name="PRM_b15" typeName="BOOL">
				<attribute name="ExtractBit" value="15"></attribute>
			</variables>
			<variables name="CHID" typeName="UINT">
				<comment>Логічний номер дискретного каналу</comment>
			</variables>
			<variables name="LORAW" typeName="INT">
				<comment>Сире (немасштабоване) значення мінімуму</comment>
			</variables>
			<variables name="HIRAW" typeName="INT">
				<comment>Сире (немасштабоване) значення максимуму</comment>
			</variables>
			<variables name="VAL" typeName="REAL">
				<comment>масштабоване значення</comment>
			</variables>
			<variables name="VALFRC" typeName="REAL">
				<comment>зберігає форсоване значення</comment>
			</variables>
			<variables name="LOENG" typeName="REAL">
				<comment>Інженерне (масштабоване) значення мінімуму</comment>
			</variables>
			<variables name="HIENG" typeName="REAL">
				<comment>Інженерне (масштабоване) значення максимуму</comment>
			</variables>
			<variables name="LOSP" typeName="REAL">
				<comment>Уставка тривоги HI</comment>
			</variables>
			<variables name="HISP" typeName="REAL">
				<comment>Уставка тривоги LO</comment>
			</variables>
			<variables name="LOLOSP" typeName="REAL">
				<comment>Уставка тривоги LOLO</comment>
			</variables>
			<variables name="HIHISP" typeName="REAL">
				<comment>Уставка тривоги HIHI</comment>
			</variables>
			<variables name="THSP" typeName="REAL">
				<comment>Технологічна уставка HI (для регулятора)</comment>
			</variables>
			<variables name="TLSP" typeName="REAL">
				<comment>Технологічна уставка LO (для регулятора)</comment>
			</variables>
			<variables name="T_FLT" typeName="UINT">
				<comment>час фільтрації в мілісекундах (фільтр - аперіодична ланка)</comment>
			</variables>
			<variables name="VRAW" typeName="INT">
				<comment>сире значення</comment>
			</variables>
			<variables name="STA2" typeName="INT">
				<comment>додаткові біти статусу та тривоги</comment>
			</variables>
			<variables name="STA2_ASPD" typeName="BOOL">
				<comment>Шивдка зміна сигналу {A.BAD.0}</comment>
				<attribute name="ExtractBit" value="0"></attribute>
			</variables>
			<variables name="STA2_AFRZ" typeName="BOOL">
				<comment>Сигнал не змінюється {A.BAD.1}</comment>
				<attribute name="ExtractBit" value="1"></attribute>
			</variables>
			<variables name="STA2_AOVRFL" typeName="BOOL">
				<comment>Перехід через верхнє значення {A.BAD.2}</comment>
				<attribute name="ExtractBit" value="2"></attribute>
			</variables>
			<variables name="STA2_AUNDRFL" typeName="BOOL">
				<comment>Перехід через нижнє значення  {A.BAD.3}</comment>
				<attribute name="ExtractBit" value="3"></attribute>
			</variables>
			<variables name="STA2_b4" typeName="BOOL">
				<attribute name="ExtractBit" value="4"></attribute>
			</variables>
			<variables name="STA2_b5" typeName="BOOL">
				<attribute name="ExtractBit" value="5"></attribute>
			</variables>
			<variables name="STA2_b6" typeName="BOOL">
				<attribute name="ExtractBit" value="6"></attribute>
			</variables>
			<variables name="STA2_b7" typeName="BOOL">
				<attribute name="ExtractBit" value="7"></attribute>
			</variables>
			<variables name="STA2_b8" typeName="BOOL">
				<attribute name="ExtractBit" value="8"></attribute>
			</variables>
			<variables name="STA2_b9" typeName="BOOL">
				<attribute name="ExtractBit" value="9"></attribute>
			</variables>
			<variables name="STA2_b10" typeName="BOOL">
				<attribute name="ExtractBit" value="10"></attribute>
			</variables>
			<variables name="STA2_b11" typeName="BOOL">
				<attribute name="ExtractBit" value="11"></attribute>
			</variables>
			<variables name="STA2_b12" typeName="BOOL">
				<attribute name="ExtractBit" value="12"></attribute>
			</variables>
			<variables name="STA2_b13" typeName="BOOL">
				<attribute name="ExtractBit" value="13"></attribute>
			</variables>
			<variables name="STA2_b14" typeName="BOOL">
				<attribute name="ExtractBit" value="14"></attribute>
			</variables>
			<variables name="STA2_b15" typeName="BOOL">
				<attribute name="ExtractBit" value="15"></attribute>
			</variables>
			<variables name="tmp" typeName="INT"></variables>
			<variables name="HYST" typeName="REAL">
				<comment>гістерезис в реальних одиницях або % (PRM_PARAISPROC)</comment>
			</variables>
			<variables name="T_DEALL" typeName="UINT">
				<comment>Час затримки на виникнення тривоги LL в 0.1 секундах</comment>
			</variables>
			<variables name="T_DEAL" typeName="UINT">
				<comment>Час затримки на виникнення тривоги L в 0.1 секундах (за необхідністю)</comment>
			</variables>
			<variables name="T_DEAH" typeName="UINT">
				<comment>Час затримки на виникнення тривоги H в 0.1 секундах (за необхідністю)</comment>
			</variables>
			<variables name="T_DEAHH" typeName="UINT">
				<comment>Час затримки на виникнення тривоги HH в 0.1 секундах (за необхідністю)</comment>
			</variables>
			<variables name="STEP1" typeName="UINT">
				<comment>номер кроку</comment>
			</variables>
			<variables name="CHIDDF" typeName="UINT">
				<comment>Логічний номер каналу за замовченням</comment>
			</variables>
			<variables name="T_STEP1" typeName="UDINT">
				<comment>Плинний час кроку в мс</comment>
			</variables>
			<variables name="T_PREV" typeName="UDINT">
				<comment>час в мс з попереднього виклику, береться зі структури PLC_CFG.TQMS</comment>
			</variables>
			<variables name="VALPRV" typeName="REAL">
				<comment>значення на попередньому циклі (для реалізації фільтрації)</comment>
			</variables>
			<variables name="VALPRV_AFRZ" typeName="REAL">
				<comment>значення на попередньому перерахунку контролю зависання (Енікон)</comment>
			</variables>
			<variables name="VALPRV_ASPD" typeName="REAL">
				<comment>значення на попередньому перерахунку контролю скачку (Енікон)</comment>
			</variables>
			<variables name="DEASP_AFRZ" typeName="REAL">
				<comment>уставка нечутливості контролю зависання (Енікон)</comment>
			</variables>
			<variables name="DOPSP_ASPD" typeName="REAL">
				<comment>уставка допуску контролю швидкості (Енікон)</comment>
			</variables>
			<variables name="ZERO_CUT_VAL" typeName="REAL">
				<comment>відсічка нуля </comment>
			</variables>
		</structure>
	</DDTSource>
	<DDTSource DDTName="AIVAR_HMI" version="0.01" dateTime="dt#2022-01-06-17:21:54">
		<attribute name="TypeSignatureCheckSumString" value="3237"></attribute>
		<structure>
			<variables name="STA" typeName="INT">
				<comment>біти стану</comment>
			</variables>
			<variables name="VALPRCSTA2" typeName="INT">
				<comment>значення у % від шкали вимірювання (0-10000) + додаткові біти статусу</comment>
			</variables>
			<variables name="VAL" typeName="REAL">
				<comment>масштабоване значення</comment>
			</variables>
		</structure>
	</DDTSource>
	<DDTSource DDTName="VARBUF" version="0.03" dateTime="dt#2022-01-08-17:23:40">
		<attribute name="TypeSignatureCheckSumString" value="0E8F"></attribute>
		<structure>
			<variables name="ID" typeName="UINT">
				<comment>Унікальний ідентифікатор завантаженої в буфер змінної</comment>
			</variables>
			<variables name="CLSID" typeName="UINT">
				<comment>CLSID завантаженої в буфер змінної</comment>
			</variables>
			<variables name="STA" typeName="INT">
				<comment>статус + біт команди завантаження в буфер</comment>
			</variables>
			<variables name="CMD" typeName="UINT">
				<comment>команда</comment>
			</variables>
			<variables name="VALPROC" typeName="INT">
				<comment>значення у % від шкали вимірювання (0-10000)</comment>
			</variables>
			<variables name="STEP1" typeName="UINT">
				<comment>номер кроку</comment>
			</variables>
			<variables name="PRM" typeName="INT">
				<comment>бітові параметри</comment>
			</variables>
			<variables name="CHID" typeName="UINT">
				<comment>Логічний номер вхідного аналогового каналу CH</comment>
			</variables>
			<variables name="VALR" typeName="REAL">
				<comment>масштабоване значення</comment>
			</variables>
			<variables name="VRAWR" typeName="REAL">
				<comment>сире значення</comment>
			</variables>
			<variables name="LORAW" typeName="INT">
				<comment>AI/AO – Сире (немасштабоване) значення мінімуму</comment>
			</variables>
			<variables name="HIRAW" typeName="INT">
				<comment>AI/AO – Сире (немасштабоване) значення максимуму</comment>
			</variables>
			<variables name="LOENG" typeName="REAL">
				<comment>AI/AO – Інженерне (масштабоване) значення мінімуму</comment>
			</variables>
			<variables name="HIENG" typeName="REAL">
				<comment>AI/AO – Інженерне (масштабоване) значення максимуму</comment>
			</variables>
			<variables name="TMPR" typeName="REAL">
				<comment>резерв</comment>
			</variables>
			<variables name="MVAL" typeName="REAL">
				<comment>AO – значення форсування</comment>
			</variables>
			<variables name="HIHISP" typeName="REAL">
				<comment>AI  - Уставка тривоги HIHI</comment>
			</variables>
			<variables name="HISP" typeName="REAL">
				<comment>AI – Уставка тривоги HI</comment>
			</variables>
			<variables name="LOSP" typeName="REAL">
				<comment>AI – Уставка тривоги LO</comment>
			</variables>
			<variables name="LOLOSP" typeName="REAL">
				<comment>AI  - Уставка тривоги LOLO</comment>
			</variables>
			<variables name="HIHISP_PRC" typeName="INT">
				<comment>AI – Уставка тривоги HIHI у 0.01 % (для відображення)</comment>
			</variables>
			<variables name="HISP_PRC" typeName="INT">
				<comment>AI – Уставка тривоги HI у 0.01 % (для відображення)</comment>
			</variables>
			<variables name="LOSP_PRC" typeName="INT">
				<comment>AI – Уставка тривоги LO у 0.01 % (для відображення)</comment>
			</variables>
			<variables name="LOLOSP_PRC" typeName="INT">
				<comment>AI – Уставка тривоги LOLO у 0.01 % (для відображення)</comment>
			</variables>
			<variables name="T_FLTSP" typeName="UINT">
				<comment>AI – заданий час фільтрації для експоненціального фільтру 0 – не фільтрувати; DI – час фільтрації для дискретного фільтру 0 – не фільтрувати</comment>
			</variables>
			<variables name="MSG" typeName="UINT">
				<comment>повідомлення</comment>
			</variables>
			<variables name="HYST" typeName="REAL">
				<comment>AI – гістерезис в реальних одиницях або % (PRM_PARAISPROC)</comment>
			</variables>
			<variables name="T_DEAHH" typeName="UINT">
				<comment>AI  Час затримки на виникнення тривоги HH в 0.1 секундах</comment>
			</variables>
			<variables name="T_DEAH" typeName="UINT">
				<comment>AI  Час затримки на виникнення тривоги H в 0.1 секундах</comment>
			</variables>
			<variables name="T_DEAL" typeName="UINT">
				<comment>AI  Час затримки на виникнення тривоги L в 0.1 секундах</comment>
			</variables>
			<variables name="T_DEALL" typeName="UINT">
				<comment>AI – Час затримки на виникнення тривоги LL в 0.1 секундах; DI – Час затримки на виникнення тривоги в секундах</comment>
			</variables>
			<variables name="T_STEP1" typeName="UDINT">
				<comment>Час кроку в мілісекундах</comment>
			</variables>
			<variables name="OPTR" typeName="ARRAY[0..3] OF REAL">
				<comment>Масив додаткових змінних REAL</comment>
			</variables>
			<variables name="OPTD" typeName="ARRAY[0..3] OF DINT">
				<comment>Масив додаткових змінних UDINT</comment>
			</variables>
			<variables name="VALPRV_AFRZ" typeName="REAL">
				<comment>значення на попередньому перерахунку контролю зависання (Енікон)</comment>
			</variables>
			<variables name="VALPRV_ASPD" typeName="REAL">
				<comment>значення на попередньому перерахунку контролю скачку (Енікон)</comment>
			</variables>
			<variables name="DEASP_AFRZ" typeName="REAL">
				<comment>уставка нечутливості контролю зависання (Енікон)</comment>
			</variables>
			<variables name="DOPSP_ASPD" typeName="REAL">
				<comment>уставка допуску контролю швидкості (Енікон)</comment>
			</variables>
			<variables name="ZERO_CUT_VAL" typeName="REAL">
				<comment>відсічка нуля </comment>
			</variables>
			<variables name="CH_CLSID" typeName="UINT">
				<comment>ідентифікатор класу каналу</comment>
			</variables>
			<variables name="CH_STA" typeName="INT">
				<comment>стани каналу</comment>
			</variables>
			<variables name="CH_VALSIG" typeName="REAL">
				<comment>значення каналу в одиницях вимірювання</comment>
			</variables>
		</structure>
	</DDTSource>
	<DDTSource DDTName="PLC_CFG" version="0.11" dateTime="dt#2022-01-13-12:47:32">
		<attribute name="TypeSignatureCheckSumString" value="1691"></attribute>
		<structure>
			<variables name="ID" typeName="UINT">
				<comment>Унікальний ідентифікатор</comment>
			</variables>
			<variables name="CLSID" typeName="UINT">
				<comment>16#21xx</comment>
			</variables>
			<variables name="STA" typeName="UINT"></variables>
			<variables name="STA_CON2ERR" typeName="BOOL">
				<comment>є помилка звязку з сусідні ПЛК в парі (для теплого резерування)</comment>
				<attribute name="ExtractBit" value="0"></attribute>
			</variables>
			<variables name="STA_PLC2STOP" typeName="BOOL">
				<comment>спарений ПЛК в стопі (для теплого резерування)</comment>
				<attribute name="ExtractBit" value="1"></attribute>
			</variables>
			<variables name="STA_BLK" typeName="BOOL">
				<comment>є хоча б один заблокований ВМ</comment>
				<attribute name="ExtractBit" value="2"></attribute>
			</variables>
			<variables name="STA_ALDIS" typeName="BOOL">
				<comment>є хоча б одна відключена тривога</comment>
				<attribute name="ExtractBit" value="3"></attribute>
			</variables>
			<variables name="STA_DIOON" typeName="BOOL">
				<comment>йде опитування по мережі (MODBUS або аналогічній) засобів віддаленого вводу/виводу</comment>
				<attribute name="ExtractBit" value="4"></attribute>
			</variables>
			<variables name="STA_DIOERR" typeName="BOOL">
				<comment>є помилка на DIO</comment>
				<attribute name="ExtractBit" value="5"></attribute>
			</variables>
			<variables name="STA_DBLCKALL" typeName="BOOL">
				<comment>усі приводи розблоковані</comment>
				<attribute name="ExtractBit" value="6"></attribute>
			</variables>
			<variables name="STA_FRC" typeName="BOOL">
				<comment>хоча б одна змінна форсована на будь якому рівні</comment>
				<attribute name="ExtractBit" value="7"></attribute>
			</variables>
			<variables name="STA_SMLALL" typeName="BOOL">
				<comment>все в режимі в імітації, примушує усі CM перейти в режим імітації</comment>
				<attribute name="ExtractBit" value="8"></attribute>
			</variables>
			<variables name="STA_DISP" typeName="BOOL">
				<comment>хоча б один елемент в режимі ручного управління</comment>
				<attribute name="ExtractBit" value="9"></attribute>
			</variables>
			<variables name="STA_FRC2" typeName="BOOL">
				<comment>є хоча б один форсований керівний елемент (рівня 2), клапан, двигун</comment>
				<attribute name="ExtractBit" value="10"></attribute>
			</variables>
			<variables name="STA_FRC1" typeName="BOOL">
				<comment>хоча б одна змінна форсована (рівня 1)</comment>
				<attribute name="ExtractBit" value="11"></attribute>
			</variables>
			<variables name="STA_SCN1" typeName="BOOL">
				<comment>перший скан</comment>
				<attribute name="ExtractBit" value="12"></attribute>
			</variables>
			<variables name="STA_FRC0" typeName="BOOL">
				<comment>хоча б одна змінна форсована (рівня 0)</comment>
				<attribute name="ExtractBit" value="13"></attribute>
			</variables>
			<variables name="STA_SML" typeName="BOOL">
				<comment> хоча б один об’єкт в режимі імітації</comment>
				<attribute name="ExtractBit" value="14"></attribute>
			</variables>
			<variables name="STA_CMDACK" typeName="BOOL">
				<comment>підтвердження команди, команда пройшла через весь цикл задачі і отримана усіма</comment>
				<attribute name="ExtractBit" value="15"></attribute>
			</variables>
			<variables name="CMD" typeName="UINT">
				<comment>Команди з HMI</comment>
			</variables>
			<variables name="CMDPRG" typeName="UINT">
				<comment>Команди з програмного керування (побітові)</comment>
			</variables>
			<variables name="PRM1" typeName="UINT">
				<comment>дискретні параметри</comment>
			</variables>
			<variables name="PRM2" typeName="UINT">
				<comment>дискретні параметри</comment>
			</variables>
			<variables name="PLS" typeName="UINT">
				<comment>бітові міандри та імпульси по часу</comment>
			</variables>
			<variables name="PLS_P100MS" typeName="BOOL">
				<comment>100 мс</comment>
				<attribute name="ExtractBit" value="0"></attribute>
			</variables>
			<variables name="PLS_P200MS" typeName="BOOL">
				<comment>200 мс</comment>
				<attribute name="ExtractBit" value="1"></attribute>
			</variables>
			<variables name="PLS_P500MS" typeName="BOOL">
				<comment>500 мс</comment>
				<attribute name="ExtractBit" value="2"></attribute>
			</variables>
			<variables name="PLS_P1S" typeName="BOOL">
				<comment>1 с</comment>
				<attribute name="ExtractBit" value="3"></attribute>
			</variables>
			<variables name="PLS_P2S" typeName="BOOL">
				<comment>2 с</comment>
				<attribute name="ExtractBit" value="4"></attribute>
			</variables>
			<variables name="PLS_P5S" typeName="BOOL">
				<comment>5 с</comment>
				<attribute name="ExtractBit" value="5"></attribute>
			</variables>
			<variables name="PLS_P10S" typeName="BOOL">
				<comment>10 с</comment>
				<attribute name="ExtractBit" value="6"></attribute>
			</variables>
			<variables name="PLS_P60S" typeName="BOOL">
				<comment>1 хв</comment>
				<attribute name="ExtractBit" value="7"></attribute>
			</variables>
			<variables name="PLS_M1S" typeName="BOOL">
				<comment>меандр з періодом 1 с (0.5 с + 0.5 с)</comment>
				<attribute name="ExtractBit" value="8"></attribute>
			</variables>
			<variables name="PLS_M2S" typeName="BOOL">
				<comment>меандр з періодом 2 с (1 с + 1 с)</comment>
				<attribute name="ExtractBit" value="9"></attribute>
			</variables>
			<variables name="PLS_b10" typeName="BOOL">
				<attribute name="ExtractBit" value="10"></attribute>
			</variables>
			<variables name="PLS_b11" typeName="BOOL">
				<attribute name="ExtractBit" value="11"></attribute>
			</variables>
			<variables name="PLS_NEWMIN" typeName="BOOL">
				<comment>=1 на один цикл основної задачі – початок хвилини</comment>
				<attribute name="ExtractBit" value="12"></attribute>
			</variables>
			<variables name="PLS_NEWHR" typeName="BOOL">
				<comment>=1 на один цикл основної задачі – початок години</comment>
				<attribute name="ExtractBit" value="13"></attribute>
			</variables>
			<variables name="PLS_NEWDAY" typeName="BOOL">
				<comment>=1 на один цикл основної задачі – початок доби</comment>
				<attribute name="ExtractBit" value="14"></attribute>
			</variables>
			<variables name="PLS_NEWSHIFT" typeName="BOOL">
				<comment>=1 на один цикл основної задачі – початок зміни</comment>
				<attribute name="ExtractBit" value="15"></attribute>
			</variables>
			<variables name="ALM1" typeName="UINT"></variables>
			<variables name="ALM_ALM" typeName="BOOL">
				<comment>активна технологічна тривога</comment>
				<attribute name="ExtractBit" value="0"></attribute>
			</variables>
			<variables name="ALM_NWALM" typeName="BOOL">
				<comment>зявилась нова технологічна тривога</comment>
				<attribute name="ExtractBit" value="1"></attribute>
			</variables>
			<variables name="ALM_ALMNACK" typeName="BOOL">
				<comment>квітування технологічної тривоги</comment>
				<attribute name="ExtractBit" value="2"></attribute>
			</variables>
			<variables name="ALM_WRN" typeName="BOOL">
				<comment>активне технологічне попередження</comment>
				<attribute name="ExtractBit" value="3"></attribute>
			</variables>
			<variables name="ALM_NWWRN" typeName="BOOL">
				<comment>зявилось нове технологічне попередження</comment>
				<attribute name="ExtractBit" value="4"></attribute>
			</variables>
			<variables name="ALM_WRNNACK" typeName="BOOL">
				<comment>квітування технологічного попередження</comment>
				<attribute name="ExtractBit" value="5"></attribute>
			</variables>
			<variables name="ALM_BAD" typeName="BOOL">
				<comment>активна тривога недостовірності даних</comment>
				<attribute name="ExtractBit" value="6"></attribute>
			</variables>
			<variables name="ALM_NWBAD" typeName="BOOL">
				<comment>нова тривога недостовірності даних</comment>
				<attribute name="ExtractBit" value="7"></attribute>
			</variables>
			<variables name="ALM_BADNACK" typeName="BOOL">
				<comment>квітування тривоги недостовірності даних</comment>
				<attribute name="ExtractBit" value="8"></attribute>
			</variables>
			<variables name="ALM_EMCYSTP" typeName="BOOL">
				<comment>швидкий зупин</comment>
				<attribute name="ExtractBit" value="9"></attribute>
			</variables>
			<variables name="ALM_STP2RUN" typeName="BOOL">
				<comment>є перехід з стану стоп в стан ран</comment>
				<attribute name="ExtractBit" value="10"></attribute>
			</variables>
			<variables name="ALM_CON2ERR" typeName="BOOL">
				<comment>є помилка звязку з сусідні ПЛК в парі (для теплого резерування)</comment>
				<attribute name="ExtractBit" value="11"></attribute>
			</variables>
			<variables name="ALM_PLC2STOP" typeName="BOOL">
				<comment>спарений ПЛК в стопі (для теплого резерування)</comment>
				<attribute name="ExtractBit" value="12"></attribute>
			</variables>
			<variables name="ALM_DIOERR" typeName="BOOL">
				<comment>є помилка на DIO </comment>
				<attribute name="ExtractBit" value="13"></attribute>
			</variables>
			<variables name="ALM_PLCERR" typeName="BOOL">
				<comment>є апаратна помилка (ПЛК)</comment>
				<attribute name="ExtractBit" value="14"></attribute>
			</variables>
			<variables name="ALM_CONHIERR" typeName="BOOL">
				<comment>є помилка звязку з верхнім рівнем</comment>
				<attribute name="ExtractBit" value="15"></attribute>
			</variables>
			<variables name="ALM2" typeName="INT">
				<comment>біти алармів</comment>
			</variables>
			<variables name="STEP1" typeName="INT">
				<comment>крок основної програми</comment>
			</variables>
			<variables name="T_STEP1" typeName="INT">
				<comment>час кроку основної програми обробки, в (с)</comment>
			</variables>
			<variables name="MSG" typeName="UDINT">
				<comment>час кроку основної програми обробки, в (с)</comment>
			</variables>
			<variables name="TQ" typeName="UDINT">
				<comment>загальний час з початку 1-го циклу контролера (в секундах)</comment>
			</variables>
			<variables name="TQM" typeName="UDINT">
				<comment>загальний час роботи ПЛК з моменту пуску (в хвилинах)</comment>
			</variables>
			<variables name="DICNT" typeName="INT">
				<comment>кількість наявних каналів DI</comment>
			</variables>
			<variables name="DOCNT" typeName="INT">
				<comment>кількість наявних каналів DO</comment>
			</variables>
			<variables name="AICNT" typeName="INT">
				<comment>кількість наявних каналів AI</comment>
			</variables>
			<variables name="AOCNT" typeName="INT">
				<comment>кількість наявних каналів AO</comment>
			</variables>
			<variables name="NOW" typeName="ARRAY[0..3] OF INT">
				<comment>плинний час астрономічний час в BCD форматі: NOW[0] seconds,-- (16#ss,--)  NOW[1] hour, minute (16#hhmm)  NOW[2] month, day (16#mmdd)  NOW[3] year (16#yyyy)</comment>
			</variables>
			<variables name="SHIFTPARA" typeName="ARRAY[0..3] OF INT">
				<comment>Години передачі змін (максимум 3 зміни): SHIFT[0] – кількість змін SHIFT[1] – передача 1-ї зміни (BCD 16#hhmm) SHIFT[2] – передача 2-ї зміни (BCD 16#hhmm)  SHIFT[3] – передача 3-ї зміни (BCD 16#hhmm)</comment>
			</variables>
			<variables name="SHIFTNMB" typeName="UINT">
				<comment>номер активної зміни</comment>
			</variables>
			<variables name="CNTALM" typeName="UINT">
				<comment>лічильник кількості активних тривог "аварія"</comment>
			</variables>
			<variables name="CNTWRN" typeName="UINT">
				<comment>лічильник кількостіактивних тривог "попередження"</comment>
			</variables>
			<variables name="CNTBAD" typeName="UINT">
				<comment>лічильник кількостіактивних тривог "недостовірність"</comment>
			</variables>
			<variables name="CNTFRC" typeName="UINT">
				<comment>лічильник кількостіфорсованих об'єктів</comment>
			</variables>
			<variables name="CNTMAN" typeName="UINT">
				<comment>лічильник кількості ВМ в ручному режимі</comment>
			</variables>
			<variables name="TSK_LTIME" typeName="UINT">
				<comment>плинний (останній) час задачі в мілісекундах</comment>
			</variables>
			<variables name="TSK_MAXTIME" typeName="UINT">
				<comment>максимальний час задачі в мілісекундах</comment>
			</variables>
			<variables name="STA_PERM" typeName="INT">
				<comment>повторює STA, який був на початку виклику функції</comment>
			</variables>
			<variables name="ALM1_PERM" typeName="INT">
				<comment>повторює ALM1, який був на початку виклику функції</comment>
			</variables>
			<variables name="CNTALM_PERM" typeName="UINT">
				<comment>лічильник кількості активних тривог "аварія"</comment>
			</variables>
			<variables name="CNTWRN_PERM" typeName="UINT">
				<comment>лічильник кількостіактивних тривог "попередження"</comment>
			</variables>
			<variables name="CNTBAD_PERM" typeName="UINT">
				<comment>лічильник кількостіактивних тривог "недостовірність"</comment>
			</variables>
			<variables name="CNTFRC_PERM" typeName="UINT">
				<comment>лічильник кількостіфорсованих об'єктів</comment>
			</variables>
			<variables name="CNTMAN_PERM" typeName="UINT">
				<comment>лічильник кількості ВМ в ручному режимі</comment>
			</variables>
			<variables name="MODULSCNT" typeName="INT">
				<comment>кількість модулів</comment>
			</variables>
			<variables name="NOWns" typeName="UDINT">
				<comment>нс (наносекунди) для плинного астрономічного часу</comment>
			</variables>
			<variables name="TQMS" typeName="UDINT">
				<comment>мілісекундний лічильник, скидається при старті або після переповнення</comment>
			</variables>
		</structure>
	</DDTSource>
	<FBSource nameOfFBType="SCALING" version="0.03" dateTime="dt#2022-01-14-11:17:15">
		<attribute name="TypeCodeCheckSumString" value="77C7"></attribute>
		<attribute name="TypeSignatureCheckSumString" value="CCDF"></attribute>
		<inputParameters>
			<variables name="IN" typeName="REAL">
				<attribute name="PositionPin" value="1"></attribute>
			</variables>
			<variables name="in_min" typeName="REAL">
				<attribute name="PositionPin" value="2"></attribute>
			</variables>
			<variables name="in_max" typeName="REAL">
				<attribute name="PositionPin" value="3"></attribute>
			</variables>
			<variables name="out_min" typeName="REAL">
				<attribute name="PositionPin" value="4"></attribute>
			</variables>
			<variables name="out_max" typeName="REAL">
				<attribute name="PositionPin" value="5"></attribute>
			</variables>
		</inputParameters>
		<inOutParameters>
			<variables name="STA" typeName="INT">
				<attribute name="PositionPin" value="6"></attribute>
			</variables>
			<variables name="PRM" typeName="INT">
				<attribute name="PositionPin" value="7"></attribute>
			</variables>
		</inOutParameters>
		<outputParameters>
			<variables name="SCALING" typeName="REAL">
				<attribute name="PositionPin" value="1"></attribute>
			</variables>
		</outputParameters>
		<privateLocalVariables>
			<variables name="PRM_SQRT" typeName="BOOL"></variables>
			<variables name="PRM_CUT" typeName="BOOL"></variables>
			<variables name="STA_ERR" typeName="BOOL"></variables>
			<variables name="STA_EQINLIMS" typeName="BOOL"></variables>
			<variables name="STA_EQOUTLIMS" typeName="BOOL"></variables>
			<variables name="tmpOUT" typeName="REAL"></variables>
			<variables name="tmpIN" typeName="REAL"></variables>
		</privateLocalVariables>
		<FBProgram name="SCALING">
			<STSource>PRM_SQRT := PRM.0;
PRM_CUT := PRM.1;
STA_ERR :=0;
STA_EQINLIMS :=0;
STA_EQOUTLIMS :=0;
SCALING:=out_min;

IF ABS(out_max - out_min)&lt;0.00001 THEN
    STA_EQOUTLIMS:=true; STA_ERR:=true;
END_IF; 
IF ABS(in_max - in_min)&lt;0.00001 THEN
    STA_EQINLIMS:=true; STA_ERR:=true;
END_IF;

IF NOT STA_ERR THEN  
    tmpIN := IN; 
    IF PRM_SQRT THEN (*квадратичне масштабування*)
        IF tmpIN&gt;0.0 and out_max&gt;0.0 THEN    
        	tmpIN:=SQRT(tmpIN)*SQRT(out_max);
	else
		tmpIN:=0.0;
	END_IF;
    ELSE (*лінійне масштабування*)
        tmpIN:=IN;
    END_IF;  
    
    tmpOUT := out_min + (tmpIN - in_min) * (out_max - out_min) / (in_max - in_min);
    IF PRM_CUT THEN
        IF tmpOUT &gt; out_max THEN
            tmpOUT:=out_max; 
        END_IF;
        IF tmpOUT &lt; out_min THEN
            tmpOUT:=out_min; 
        END_IF;
    END_IF;
    SCALING:=tmpOUT;
ELSE 
    ;
END_IF;

STA.0:= STA_ERR;
STA.1:= STA_EQINLIMS;
STA.2:= STA_EQOUTLIMS;
</STSource>
		</FBProgram>
	</FBSource>
	<FBSource nameOfFBType="A_FLTR" version="0.03" dateTime="dt#2022-01-14-11:17:15">
		<attribute name="TypeCodeCheckSumString" value="FDD3"></attribute>
		<attribute name="TypeSignatureCheckSumString" value="C4BD"></attribute>
		<inputParameters>
			<variables name="IN" typeName="REAL">
				<attribute name="PositionPin" value="1"></attribute>
			</variables>
			<variables name="dT1" typeName="UDINT">
				<comment>час між викликами в мс</comment>
				<attribute name="PositionPin" value="2"></attribute>
			</variables>
			<variables name="T_FLT" typeName="UDINT">
				<comment>час фільтрації</comment>
				<attribute name="PositionPin" value="3"></attribute>
			</variables>
		</inputParameters>
		<inOutParameters>
			<variables name="PRM" typeName="INT">
				<comment>бітові параметри</comment>
				<attribute name="PositionPin" value="4"></attribute>
			</variables>
			<variables name="STA" typeName="INT">
				<comment>стан</comment>
				<attribute name="PositionPin" value="5"></attribute>
			</variables>
			<variables name="VALPRV" typeName="REAL">
				<comment>значення з поепереднього та для наступного виклику</comment>
				<attribute name="PositionPin" value="6"></attribute>
			</variables>
		</inOutParameters>
		<outputParameters>
			<variables name="A_FLTR" typeName="REAL">
				<attribute name="PositionPin" value="1"></attribute>
			</variables>
		</outputParameters>
		<privateLocalVariables>
			<variables name="SaveVal" typeName="REAL"></variables>
			<variables name="dTr" typeName="REAL"></variables>
			<variables name="T_FLTr" typeName="REAL"></variables>
		</privateLocalVariables>
		<FBProgram name="A_FLTR">
			<STSource>(*експоненційна фільтрація*)
dTr:=UDINT_TO_REAL(dT1);
T_FLTr:=UDINT_TO_REAL(T_FLT);
SaveVal := VALPRV;
A_FLTR := dTr / (2.0 * T_FLTr + (dTr)) * (IN - SaveVal) + SaveVal;
VALPRV := IN - (2.0 * T_FLTr - (dTr)) / (2.0 * T_FLTr + (dTr)) * (IN - SaveVal); 
</STSource>
		</FBProgram>
	</FBSource>
	<FBSource nameOfFBType="INT_TO_SIGU" version="0.02" dateTime="dt#2022-01-12-16:53:04">
		<attribute name="TypeCodeCheckSumString" value="57B7"></attribute>
		<attribute name="TypeSignatureCheckSumString" value="9477"></attribute>
		<inputParameters>
			<variables name="CLSID" typeName="UINT">
				<attribute name="PositionPin" value="1"></attribute>
			</variables>
			<variables name="VALINT" typeName="INT">
				<attribute name="PositionPin" value="2"></attribute>
			</variables>
		</inputParameters>
		<outputParameters>
			<variables name="INT_TO_SIGU" typeName="REAL">
				<attribute name="PositionPin" value="1"></attribute>
			</variables>
		</outputParameters>
		<privateLocalVariables>
			<variables name="RAWMIN" typeName="REAL"></variables>
			<variables name="RAWMAX" typeName="REAL"></variables>
			<variables name="SIGMIN" typeName="REAL"></variables>
			<variables name="SIGMAX" typeName="REAL"></variables>
			<variables name="VALREAL" typeName="REAL"></variables>
		</privateLocalVariables>
		<FBProgram name="INT_TO_SIGU">
			<STSource>(*перетворення одиниць ПЛК в вимірювальні одиниці
 CHAI
- 16#0030 - загальний клас без означення типу сигналу
- 16#0031 - 4..20 mA
- 16#0032 - 0..20 mA
- 16#0033 - 0..10 V
- 16#0034 - термометр опору (без означення типу)
- 16#0035 - термопара (без означення типу)
 CHAO
- 16#0040 - загальний клас без означення типу сигналу
- 16#0041 - 4..20 mA
- 16#0042 - 0..20 mA
- 16#0043 - 0..10 V

Інші класи задаються при необхідності.
*)
(*10000*)
RAWMIN := 0.0;
RAWMAX := 10000.0;
VALREAL := INT_TO_REAL (VALINT);
CASE CLSID OF
  16#0031,16#0041 :  (*// 4..20 mA*)
    SIGMIN := 4.0; SIGMAX := 20.0;
  16#0032,16#0042 :  (*// 0..20 mA*)
    SIGMIN := 0.0; SIGMAX := 20.0;
  16#0033, 16#0043:  (*// 0..10 V*)
    SIGMIN := 0.0; SIGMAX := 10.0;

ELSE  (*%*)
    SIGMIN := 0.0; SIGMAX := 100.0;
END_CASE;

INT_TO_SIGU := SIGMIN + (INT_TO_REAL(VALINT) - RAWMIN)*(SIGMAX-SIGMIN)/(RAWMAX - RAWMIN);
</STSource>
		</FBProgram>
	</FBSource>
	<FBSource nameOfFBType="AOVARFN" version="0.17" dateTime="dt#2022-01-16-20:21:05">
		<attribute name="TypeCodeCheckSumString" value="E065"></attribute>
		<attribute name="TypeSignatureCheckSumString" value="30DD"></attribute>
		<inOutParameters>
			<variables name="CHCFG" typeName="CH_CFG">
				<attribute name="PositionPin" value="1"></attribute>
			</variables>
			<variables name="AOVARCFG" typeName="AOVAR_CFG">
				<attribute name="PositionPin" value="2"></attribute>
			</variables>
			<variables name="AOVARHMI" typeName="AOVAR_HMI">
				<attribute name="PositionPin" value="3"></attribute>
			</variables>
			<variables name="VARBUF" typeName="VARBUF">
				<attribute name="PositionPin" value="4"></attribute>
			</variables>
			<variables name="PLCCFG" typeName="PLC_CFG">
				<attribute name="PositionPin" value="5"></attribute>
			</variables>
			<variables name="CHAO" typeName="ARRAY[0..4] OF CH_CFG">
				<attribute name="PositionPin" value="6"></attribute>
			</variables>
		</inOutParameters>
		<privateLocalVariables>
			<variables name="BAD" typeName="BOOL"></variables>
			<variables name="ALDIS" typeName="BOOL"></variables>
			<variables name="DLNK" typeName="BOOL"></variables>
			<variables name="ENBL" typeName="BOOL"></variables>
			<variables name="INBUF" typeName="BOOL"></variables>
			<variables name="FRC" typeName="BOOL"></variables>
			<variables name="SML" typeName="BOOL"></variables>
			<variables name="CMDLOAD" typeName="BOOL"></variables>
			<variables name="PRM_QALENBL" typeName="BOOL"></variables>
			<variables name="PRM_DSBL" typeName="BOOL"></variables>
			<variables name="PRM_PWLENBL" typeName="BOOL"></variables>
			<variables name="CMD" typeName="UINT"></variables>
			<variables name="VARENBL" typeName="BOOL"></variables>
			<variables name="VRAW" typeName="INT"></variables>
			<variables name="T_STEPMS" typeName="UDINT"></variables>
			<variables name="dT1" typeName="UDINT"></variables>
			<variables name="VAL" typeName="REAL"></variables>
			<variables name="LORAW" typeName="INT"></variables>
			<variables name="HIRAW" typeName="INT"></variables>
			<variables name="LOENG" typeName="REAL"></variables>
			<variables name="HIENG" typeName="REAL"></variables>
			<variables name="MVAL" typeName="REAL"></variables>
			<variables name="T_FLT" typeName="UINT"></variables>
			<variables name="VAL1PROC" typeName="REAL"></variables>
			<variables name="tempBAD" typeName="BOOL"></variables>
			<variables name="TDEAQALSP" typeName="INT"></variables>
			<variables name="VALPROC" typeName="REAL"></variables>
			<variables name="VALFLT" typeName="REAL"></variables>
			<variables name="tmpuint" typeName="INT"></variables>
			<variables name="STA_SCL" typeName="INT"></variables>
			<variables name="PRM_SCL" typeName="INT"></variables>
			<variables name="A_FLTR" typeName="A_FLTR"></variables>
			<variables name="SCALING" typeName="SCALING"></variables>
			<variables name="INT_TO_SIGU" typeName="INT_TO_SIGU"></variables>
		</privateLocalVariables>
		<FBProgram name="AOVARFN">
			<STSource>
IF PLCCFG.STA_SCN1 THEN
    AOVARCFG.CLSID := 16#1040;
    AOVARCFG.PRM_DSBL := FALSE;
    AOVARCFG.PRM_QALENBL := true;
    AOVARCFG.T_PREV := PLCCFG.TQMS;
    IF AOVARCFG.CHID = 0 THEN
        AOVARCFG.CHID := AOVARCFG.CHIDDF;
    END_IF;
    IF CHCFG.ID &gt; 0 THEN
        CHCFG.VAL := AOVARCFG.VRAW;
    ELSE
        CHCFG.VAL := 0;
    END_IF;
    AOVARCFG.T_STEP1 := 0;
    AOVARCFG.STEP1 := 100;
    RETURN;
END_IF;

BAD := AOVARCFG.STA_BAD;
ALDIS := AOVARCFG.STA_ALDIS;
DLNK := AOVARCFG.STA_DLNK;
ENBL := AOVARCFG.STA_ENBL;
INBUF := AOVARCFG.STA_INBUF;
FRC := AOVARCFG.STA_FRC;
SML := AOVARCFG.STA_SML;
CMDLOAD := AOVARCFG.STA_CMDLOAD;

PRM_QALENBL := AOVARCFG.PRM_QALENBL;
PRM_DSBL := AOVARCFG.PRM_DSBL;
PRM_PWLENBL := AOVARCFG.PRM_PWLENBL;

LORAW := AOVARCFG.LORAW;
HIRAW := AOVARCFG.HIRAW;
LOENG := AOVARCFG.LOENG;
HIENG := AOVARCFG.HIENG;
MVAL := AOVARCFG.MVAL;
IF AOVARCFG.T_FLT &lt;= 0 THEN
   AOVARCFG.T_FLT := 1;
END_IF;
T_FLT := AOVARCFG.T_FLT;

INBUF := (AOVARCFG.ID = VARBUF.ID) AND (AOVARCFG.CLSID = VARBUF.CLSID);
CMDLOAD := AOVARHMI.STA.15;
CMD := 0;
DLNK := (CHCFG.ID &gt; 0);
VARENBL := NOT PRM_DSBL AND DLNK;
T_STEPMS := AOVARCFG.T_STEP1;

VAL := AOVARCFG.VAL;
VRAW := AOVARCFG.VRAW;

(*ping-pong*)
IF DLNK THEN
    CHCFG.STA_PNG := true;
    CHCFG.VARID := AOVARCFG.ID;
END_IF;

IF NOT VARENBL THEN
    (*  DOVARCFG.STA.VRAW := VRAW;*)
    AOVARCFG.T_STEP1 := 0;
    AOVARCFG.STEP1 := 400;
END_IF;

dT1 := PLCCFG.TQMS - AOVARCFG.T_PREV;

(* широкомовне дефорсування*) 
IF PLCCFG.CMD = 16#4302 THEN
    FRC := false; (*дефорсувати об'єкт типу*)
END_IF;

IF CMDLOAD THEN
    CMD := 16#0100;
ELSIF INBUF AND VARBUF.CMD &lt;&gt; 0 THEN
    CMD := VARBUF.CMD;
END_IF;

(*commands*)
CASE CMD OF
    16#0001: (*записати максимум діапазону*)
        IF FRC AND INBUF THEN
            AOVARCFG.VALFRC := AOVARCFG.HIENG;
            VAL := AOVARCFG.HIENG;
            AOVARCFG.STEP1 := 100;
            AOVARCFG.T_STEP1 := 0;
        END_IF;
    16#0002: (*записати мінімум діапазону*)
        IF FRC AND INBUF THEN
            AOVARCFG.VALFRC := AOVARCFG.LOENG;
            VAL := AOVARCFG.LOENG;
            AOVARCFG.STEP1 := 100;
            AOVARCFG.T_STEP1 := 0;
        END_IF;
    16#0003: (*записати середину діапазону*)
        IF FRC AND INBUF THEN
            AOVARCFG.VALFRC := (AOVARCFG.HIENG - AOVARCFG.LOENG) / 2.0;
            VAL := (AOVARCFG.HIENG - AOVARCFG.LOENG) / 2.0;
            AOVARCFG.STEP1 := 100;
            AOVARCFG.T_STEP1 := 0;
        END_IF;
    16#0100: (*прочитати конфігурацію*)
        VARBUF.MSG := 201; 
        VARBUF.PRM.6 := PRM_QALENBL;
        VARBUF.PRM.7 := PRM_DSBL;
        VARBUF.PRM.8 := PRM_PWLENBL;
        
        VARBUF.ID := AOVARCFG.ID;
        VARBUF.CLSID := AOVARCFG.CLSID;
        VARBUF.CHID := AOVARCFG.CHID;
        VARBUF.VALR := AOVARCFG.VALFRC;
        
        VARBUF.LORAW := LORAW;
        VARBUF.HIRAW := HIRAW;
        VARBUF.LOENG := LOENG;
        VARBUF.HIENG := HIENG;
        VARBUF.MVAL := MVAL;
        VARBUF.T_FLTSP := T_FLT;
        
        (*VARBUF.STEP1 := DIVARCFG.STEP1;*)
        (*VARBUF.T_STEP1 := DIVARCFG.T_STEP1;*)
        
    16#0101: (*записати конфігурацію*)
                (* MSG 200-Ok 400-Error
            // 200 - Дані записані
            // 201 - Дані прочитані 
            // 403 - канал вже зайнятий 
            // 404 - номер каналу не відповідає діапазону   *)
        PRM_QALENBL := VARBUF.PRM.6;
        PRM_DSBL := VARBUF.PRM.7;
        PRM_PWLENBL := VARBUF.PRM.8;
        
        LORAW := VARBUF.LORAW;
        HIRAW := VARBUF.HIRAW;
        LOENG := VARBUF.LOENG;
        HIENG := VARBUF.HIENG;
        MVAL := VARBUF.MVAL;
        T_FLT := VARBUF.T_FLTSP;
        
        (*перевіряти незайнятість каналу треба в функції контролю буферу *)
            VARBUF.MSG:=200; 
            IF VARBUF.CHID&gt;=0 AND VARBUF.CHID &lt;= INT_TO_UINT(PLCCFG.AOCNT) THEN
                IF CHAO[VARBUF.CHID].VARID = 0 THEN 
                    AOVARCFG.CHID := VARBUF.CHID;
                ELSIF VARBUF.CHID &lt;&gt; AOVARCFG.CHID THEN 
                    VARBUF.MSG := 403;(* канал вже зайнятий*)
                END_IF;
            ELSE 
                VARBUF.MSG := 404; (*номер каналу не відповідає діапазону*)
            END_IF;


        IF INBUF THEN
            VARBUF.CHID := AOVARCFG.CHID;
        END_IF;
        
        
    16#0102: (*записати значення за замовченням*)
        AOVARCFG.CHID := AOVARCFG.CHIDDF;
        ;
    16#0300: (*перемкнути форсування*)
        FRC := NOT FRC;
    16#0301: (*форсувати один/усі об'єкти типу*)
        FRC := true;
    16#0302: (*дефорсувати один/усі об'єкти типу*)
        FRC := false;
    16#0311: (* імітувати*)
        SML := true;
    16#0312: (* зняти режим імітації*)
        SML := false;
END_CASE;

IF ABS (HIRAW - LORAW) &lt; 1 THEN
    LORAW := 0;
    HIRAW := 10000;
END_IF;
IF ABS(HIENG - LOENG) &lt; 0.00001 THEN
    LOENG := 0.0;
    HIENG := 100.0;
END_IF;
VAL1PROC := INT_TO_REAL(HIRAW - LORAW) / 100.0; (* значення у % від шкали вимірювання *)

(*val*)
IF FRC THEN (*режим форсування*)
    IF INBUF THEN
        AOVARCFG.VALFRC := VARBUF.VALR;
    END_IF;
    VAL := AOVARCFG.VALFRC;
ELSE
    AOVARCFG.VALFRC := VAL;
END_IF;

IF VARENBL THEN
    IF AOVARCFG.VALPRV&lt;LOENG THEN AOVARCFG.VALPRV:=LOENG; END_IF;
    IF AOVARCFG.VALPRV&gt;HIENG THEN AOVARCFG.VALPRV:=HIENG; END_IF;
    (*фільтрація*)

A_FLTR (IN := VAL,
        dT1 := dT1,
        T_FLT := UINT_TO_UDINT(T_FLT),
        PRM := tmpuint,
        STA := tmpuint,
        VALPRV := AOVARCFG.VALPRV,
        A_FLTR =&gt; VALFLT);

    (*масштабування*)
    PRM_SCL:=0;STA_SCL:=0;
    PRM_SCL.0 := false;(*//квадратнокоренева залежність, X0  *)
    PRM_SCL.1 := FALSE;(*//обмежувати вихідну величину, X1 *)  
SCALING (IN := VALFLT,
         in_min := LOENG,
         in_max := HIENG,
         out_min := INT_TO_REAL(LORAW),
         out_max := INT_TO_REAL(HIRAW),
         STA := STA_SCL,
         PRM := PRM_SCL);
 VRAW:=REAL_TO_INT(SCALING.SCALING);


    IF NOT SML THEN
        CHCFG.VAL := VRAW;
    END_IF;(* режим симуляції - вихідне значення не змінюється *)
END_IF;

(*недостовірність каналу*)
tempBAD := CHCFG.STA_BAD AND PRM_QALENBL AND VARENBL AND NOT SML;
TDEAQALSP := 10;     (* час затримки на виникнення тривог бед в 0.1 с*)

CASE AOVARCFG.STEP1 OF
    0:(*init*)
        AOVARCFG.STEP1 := 100;
        AOVARCFG.T_STEP1 := 0;
    100:(*norma*)
        BAD := false;
        IF tempBAD THEN
            AOVARCFG.STEP1 := 150;
            AOVARCFG.T_STEP1 := 0;
        END_IF;
    150:(*norma to BAD*)
        IF AOVARCFG.T_STEP1 &gt; INT_TO_UDINT(TDEAQALSP) THEN
            AOVARCFG.STEP1 := 200;
            AOVARCFG.T_STEP1 := 0;
        ELSIF NOT tempBAD THEN
            AOVARCFG.STEP1 := 100;
            AOVARCFG.T_STEP1 := 0;
        END_IF;
    200:(*BAD*)
        BAD := true;
        IF NOT tempBAD AND AOVARCFG.T_STEP1 &gt; INT_TO_UDINT(TDEAQALSP) THEN
            AOVARCFG.STEP1 := 100;
            AOVARCFG.T_STEP1 := 0;
        END_IF;
    ELSE
        AOVARCFG.STEP1 := 0;
END_CASE;


IF BAD THEN
    PLCCFG.ALM_BAD := true;
    PLCCFG.CNTBAD := PLCCFG.CNTBAD + 1;
    IF NOT AOVARCFG.STA_BAD THEN
        PLCCFG.ALM_NWBAD := true;
    END_IF;
END_IF;
IF FRC THEN
    PLCCFG.STA_FRC1 := true;
    PLCCFG.CNTFRC := PLCCFG.CNTFRC + 1;
END_IF;
IF SML THEN
    PLCCFG.STA_SML := true;
END_IF;

CMDLOAD := FALSE;

AOVARCFG.STA_BAD := BAD;
AOVARCFG.STA_ALDIS := ALDIS;
AOVARCFG.STA_DLNK := DLNK;
AOVARCFG.STA_ENBL := VARENBL;
AOVARCFG.STA_INBUF := INBUF;
AOVARCFG.STA_FRC := FRC;
AOVARCFG.STA_SML := SML;
AOVARCFG.STA_CMDLOAD :=  FALSE;

AOVARCFG.PRM_QALENBL := PRM_QALENBL;
AOVARCFG.PRM_DSBL := PRM_DSBL;
AOVARCFG.PRM_PWLENBL := PRM_PWLENBL;

AOVARHMI.STA := AOVARCFG.STA;

IF VAL1PROC = 0.0 THEN
    VAL1PROC := 1.0;
END_IF;
VALPROC := INT_TO_REAL(CHCFG.VAL - LORAW) / VAL1PROC;
IF VALPROC &lt; 0.0 THEN
    VALPROC := 0.0;
END_IF;
IF VALPROC &gt; 100.0 THEN
    VALPROC := 100.0;
END_IF;

AOVARCFG.VAL := VAL;
AOVARHMI.VAL := VAL;
AOVARCFG.VRAW := VRAW;
AOVARCFG.VALPROC := REAL_TO_INT(VALPROC*256.0) AND 16#FF00;(*по аналогії з AIVAR*)
AOVARHMI.VALPROC := AOVARCFG.VALPROC;

AOVARCFG.LORAW := LORAW;
AOVARCFG.HIRAW := HIRAW;
AOVARCFG.LOENG := LOENG;
AOVARCFG.HIENG := HIENG;
AOVARCFG.MVAL := MVAL;
AOVARCFG.T_FLT := T_FLT;

AOVARCFG.T_PREV := PLCCFG.TQMS;

AOVARCFG.T_STEP1 := AOVARCFG.T_STEP1 + dT1;
IF AOVARCFG.T_STEP1 &gt; 16#7FFF_FFFF THEN
    AOVARCFG.T_STEP1 := 16#7FFF_FFFF;
END_IF;

IF INBUF THEN
    VARBUF.CMD := 0;
    VARBUF.STA := AOVARHMI.STA;
    VARBUF.VRAWR := INT_TO_REAL(VRAW);
    VARBUF.VALR := VAL;
    VARBUF.VALPROC := AOVARCFG.VALPROC;
    VARBUF.STEP1 := AOVARCFG.STEP1;
    VARBUF.T_STEP1 := AOVARCFG.T_STEP1;
    
    VARBUF.CH_CLSID := CHCFG.CLSID;
    VARBUF.CH_STA.0 := CHCFG.STA_VRAW;
    VARBUF.CH_STA.1 := CHCFG.STA_VALB;
    VARBUF.CH_STA.2 := CHCFG.STA_BAD;
    VARBUF.CH_STA.3 := CHCFG.STA_b3;
    VARBUF.CH_STA.4 := CHCFG.STA_PNG;
    VARBUF.CH_STA.5 := CHCFG.STA_ULNK;
    VARBUF.CH_STA.6 := CHCFG.STA_MERR;
    VARBUF.CH_STA.7 := CHCFG.STA_BRK;
    VARBUF.CH_STA.8 := CHCFG.STA_SHRT;
    VARBUF.CH_STA.9 := CHCFG.STA_NBD;
    VARBUF.CH_STA.10 := CHCFG.STA_b10;
    VARBUF.CH_STA.11 := CHCFG.STA_INIOTBUF;
    VARBUF.CH_STA.12 := CHCFG.STA_INBUF;
    VARBUF.CH_STA.13 := CHCFG.STA_FRC;
    VARBUF.CH_STA.14 := CHCFG.STA_SML;
    VARBUF.CH_STA.15 := CHCFG.STA_CMDLOAD;
    INT_TO_SIGU (CLSID := CHCFG.CLSID,
             	 VALINT := VRAW,
                 INT_TO_SIGU =&gt; VARBUF.CH_VALSIG);
    
END_IF;

</STSource>
		</FBProgram>
	</FBSource>
	<DDTSource DDTName="AOVAR_CFG" version="0.02" dateTime="dt#2022-01-16-20:15:52">
		<attribute name="TypeSignatureCheckSumString" value="5CDB"></attribute>
		<structure>
			<variables name="ID" typeName="UINT">
				<comment>Унікальний ідентифікатор</comment>
			</variables>
			<variables name="CLSID" typeName="UINT">
				<comment>16#1040</comment>
			</variables>
			<variables name="STA" typeName="INT">
				<comment>статус (див STC)</comment>
			</variables>
			<variables name="STA_b0" typeName="BOOL">
				<attribute name="ExtractBit" value="0"></attribute>
			</variables>
			<variables name="STA_b1" typeName="BOOL">
				<attribute name="ExtractBit" value="1"></attribute>
			</variables>
			<variables name="STA_BAD" typeName="BOOL">
				<comment>=1 – Дані недостовірні {A.BAD.2}</comment>
				<attribute name="ExtractBit" value="2"></attribute>
			</variables>
			<variables name="STA_ALDIS" typeName="BOOL">
				<comment>=1 – Тривога виведена з експлуатації {A.MSG.3}</comment>
				<attribute name="ExtractBit" value="3"></attribute>
			</variables>
			<variables name="STA_DLNK" typeName="BOOL">
				<comment>=1 – якщо прив’язаний до каналу</comment>
				<attribute name="ExtractBit" value="4"></attribute>
			</variables>
			<variables name="STA_ENBL" typeName="BOOL">
				<comment>=1 – змінна задіяна</comment>
				<attribute name="ExtractBit" value="5"></attribute>
			</variables>
			<variables name="STA_b6" typeName="BOOL">
				<attribute name="ExtractBit" value="6"></attribute>
			</variables>
			<variables name="STA_b7" typeName="BOOL">
				<attribute name="ExtractBit" value="7"></attribute>
			</variables>
			<variables name="STA_b8" typeName="BOOL">
				<attribute name="ExtractBit" value="8"></attribute>
			</variables>
			<variables name="STA_b9" typeName="BOOL">
				<attribute name="ExtractBit" value="9"></attribute>
			</variables>
			<variables name="STA_b10" typeName="BOOL">
				<attribute name="ExtractBit" value="10"></attribute>
			</variables>
			<variables name="STA_b11" typeName="BOOL">
				<attribute name="ExtractBit" value="11"></attribute>
			</variables>
			<variables name="STA_INBUF" typeName="BOOL">
				<comment>=1 – змінна в буфері</comment>
				<attribute name="ExtractBit" value="12"></attribute>
			</variables>
			<variables name="STA_FRC" typeName="BOOL">
				<comment>=1 – Режим форсування{A.MSG.13}</comment>
				<attribute name="ExtractBit" value="13"></attribute>
			</variables>
			<variables name="STA_SML" typeName="BOOL">
				<comment>=1 – змінна в режимі симуляції</comment>
				<attribute name="ExtractBit" value="14"></attribute>
			</variables>
			<variables name="STA_CMDLOAD" typeName="BOOL">
				<comment>=1 – команда завантаження в буфер</comment>
				<attribute name="ExtractBit" value="15"></attribute>
			</variables>
			<variables name="VRAW" typeName="INT">
				<comment>сирі значення</comment>
			</variables>
			<variables name="VAL" typeName="REAL">
				<comment>масштабоване значення</comment>
			</variables>
			<variables name="VALFRC" typeName="REAL">
				<comment>зберігає форсоване значення</comment>
			</variables>
			<variables name="VALPRV" typeName="REAL">
				<comment>зберігає попереднє значення</comment>
			</variables>
			<variables name="PRM" typeName="INT">
				<comment>параметри</comment>
			</variables>
			<variables name="PRM_b0" typeName="BOOL">
				<attribute name="ExtractBit" value="0"></attribute>
			</variables>
			<variables name="PRM_b1" typeName="BOOL">
				<attribute name="ExtractBit" value="1"></attribute>
			</variables>
			<variables name="PRM_b2" typeName="BOOL">
				<attribute name="ExtractBit" value="2"></attribute>
			</variables>
			<variables name="PRM_b3" typeName="BOOL">
				<attribute name="ExtractBit" value="3"></attribute>
			</variables>
			<variables name="PRM_b4" typeName="BOOL">
				<attribute name="ExtractBit" value="4"></attribute>
			</variables>
			<variables name="PRM_b5" typeName="BOOL">
				<attribute name="ExtractBit" value="5"></attribute>
			</variables>
			<variables name="PRM_QALENBL" typeName="BOOL">
				<comment>=1 – задіяти тривогу недостовірності каналу</comment>
				<attribute name="ExtractBit" value="6"></attribute>
			</variables>
			<variables name="PRM_DSBL" typeName="BOOL">
				<comment>=1 – змінна не задіяна</comment>
				<attribute name="ExtractBit" value="7"></attribute>
			</variables>
			<variables name="PRM_PWLENBL" typeName="BOOL">
				<comment>=1 – задіяна кусочно-лінійна інтерполяція (не використовувати разом з TOTALON)</comment>
				<attribute name="ExtractBit" value="8"></attribute>
			</variables>
			<variables name="PRM_b9" typeName="BOOL">
				<attribute name="ExtractBit" value="9"></attribute>
			</variables>
			<variables name="PRM_b10" typeName="BOOL">
				<attribute name="ExtractBit" value="10"></attribute>
			</variables>
			<variables name="PRM_b11" typeName="BOOL">
				<attribute name="ExtractBit" value="11"></attribute>
			</variables>
			<variables name="PRM_b12" typeName="BOOL">
				<attribute name="ExtractBit" value="12"></attribute>
			</variables>
			<variables name="PRM_b13" typeName="BOOL">
				<attribute name="ExtractBit" value="13"></attribute>
			</variables>
			<variables name="PRM_b14" typeName="BOOL">
				<attribute name="ExtractBit" value="14"></attribute>
			</variables>
			<variables name="PRM_b15" typeName="BOOL">
				<attribute name="ExtractBit" value="15"></attribute>
			</variables>
			<variables name="CHID" typeName="UINT">
				<comment>Логічний номер вихідного аналогового каналу CH</comment>
			</variables>
			<variables name="LORAW" typeName="INT">
				<comment>Сире (немасштабоване) значення мінімуму</comment>
			</variables>
			<variables name="HIRAW" typeName="INT">
				<comment>Сире (немасштабоване) значення максимуму</comment>
			</variables>
			<variables name="LOENG" typeName="REAL">
				<comment>Інженерне (масштабоване) значення мінімуму</comment>
			</variables>
			<variables name="HIENG" typeName="REAL">
				<comment>Інженерне (масштабоване) значення максимуму</comment>
			</variables>
			<variables name="MVAL" typeName="REAL">
				<comment>ручне(форсоване) значення</comment>
			</variables>
			<variables name="T_FLT" typeName="UINT">
				<comment>час фільтрації в мілісекундах (фільтр - аперіодична ланка)</comment>
			</variables>
			<variables name="VALPROC" typeName="INT">
				<comment>значення у відсотках</comment>
			</variables>
			<variables name="STEP1" typeName="UINT">
				<comment>номер кроку</comment>
			</variables>
			<variables name="CHIDDF" typeName="UINT">
				<comment>Логічний номер дискретного каналу за замовченням</comment>
			</variables>
			<variables name="T_STEP1" typeName="UDINT">
				<comment>Плинний час кроку в мс</comment>
			</variables>
			<variables name="T_PREV" typeName="UDINT">
				<comment>час в мс з попереднього виклику, береться зі структури PLC_CFG.TQMS</comment>
			</variables>
		</structure>
	</DDTSource>
	<DDTSource DDTName="AOVAR_HMI" version="0.01" dateTime="dt#2022-01-06-17:23:18">
		<attribute name="TypeSignatureCheckSumString" value="92BD"></attribute>
		<structure>
			<variables name="STA" typeName="INT">
				<comment>біти стану</comment>
			</variables>
			<variables name="VALPROC" typeName="INT">
				<comment>значення у % від шкали вимірювання (0-10000)</comment>
			</variables>
			<variables name="VAL" typeName="REAL">
				<comment>масштабоване значення</comment>
			</variables>
		</structure>
	</DDTSource>
	<FBSource nameOfFBType="DIVARFN" version="0.16" dateTime="dt#2022-01-19-19:52:10">
		<attribute name="TypeCodeCheckSumString" value="6478"></attribute>
		<attribute name="TypeSignatureCheckSumString" value="4AE9"></attribute>
		<inOutParameters>
			<variables name="CHCFG" typeName="CH_CFG">
				<attribute name="PositionPin" value="1"></attribute>
			</variables>
			<variables name="DIVARCFG" typeName="DIVAR_CFG">
				<attribute name="PositionPin" value="2"></attribute>
			</variables>
			<variables name="DIVARHMI" typeName="DIVAR_HMI">
				<attribute name="PositionPin" value="3"></attribute>
			</variables>
			<variables name="VARBUF" typeName="VARBUF">
				<attribute name="PositionPin" value="4"></attribute>
			</variables>
			<variables name="PLCCFG" typeName="PLC_CFG">
				<attribute name="PositionPin" value="5"></attribute>
			</variables>
			<variables name="CHDI" typeName="ARRAY[0..32] OF CH_CFG">
				<attribute name="PositionPin" value="6"></attribute>
			</variables>
		</inOutParameters>
		<privateLocalVariables>
			<variables name="VRAW" typeName="BOOL"></variables>
			<variables name="VAL" typeName="BOOL"></variables>
			<variables name="BAD" typeName="BOOL"></variables>
			<variables name="ALDIS" typeName="BOOL"></variables>
			<variables name="DLNK" typeName="BOOL"></variables>
			<variables name="ENBL" typeName="BOOL"></variables>
			<variables name="ALM" typeName="BOOL"></variables>
			<variables name="VALPRV" typeName="BOOL"></variables>
			<variables name="ISALM" typeName="BOOL"></variables>
			<variables name="ISWRN" typeName="BOOL"></variables>
			<variables name="WRN" typeName="BOOL"></variables>
			<variables name="INBUF" typeName="BOOL"></variables>
			<variables name="FRC" typeName="BOOL"></variables>
			<variables name="SML" typeName="BOOL"></variables>
			<variables name="CMDLOAD" typeName="BOOL"></variables>
			<variables name="PRM_ISALM" typeName="BOOL"></variables>
			<variables name="PRM_ISWRN" typeName="BOOL"></variables>
			<variables name="PRM_INVERSE" typeName="BOOL"></variables>
			<variables name="PRM_NRMVAL" typeName="BOOL"></variables>
			<variables name="PRM_QALENBL" typeName="BOOL"></variables>
			<variables name="PRM_DSBL" typeName="BOOL"></variables>
			<variables name="VARENBL" typeName="BOOL"></variables>
			<variables name="CMD" typeName="UINT"></variables>
			<variables name="dT1" typeName="UDINT"></variables>
			<variables name="DI" typeName="BOOL"></variables>
			<variables name="T_STEPMS" typeName="UDINT"></variables>
		</privateLocalVariables>
		<FBProgram name="DIVARFN">
			<STSource>(*DIVARCFG.CLSID 
16#1010 - класичний
16#1011 - з лічильником в полі VALI, не змінюється в цій функції в нормальному режимі*)
IF PLCCFG.STA_SCN1 THEN
    DIVARCFG.CLSID := 16#1010;
    DIVARCFG.PRM_DSBL := FALSE;
    DIVARCFG.T_PREV := PLCCFG.TQMS;
    IF DIVARCFG.CHID = 0 THEN
        DIVARCFG.CHID := DIVARCFG.CHIDDF;
    END_IF;
    IF CHCFG.ID &gt; 0 THEN
        VRAW := CHCFG.STA_VALB;
    ELSE
        VRAW := 0;
    END_IF;
    DIVARCFG.STA_VALPRV := VRAW;
    DIVARCFG.STA_VRAW := DIVARCFG.STA_VALPRV;
    DIVARCFG.STA_VALB := DIVARCFG.STA_VRAW;
    DIVARCFG.T_STEP1 := 0;
    DIVARCFG.STEP1 := 400;
    RETURN;
END_IF;

VRAW := DIVARCFG.STA_VRAW;
VAL := DIVARCFG.STA_VALB;
BAD := DIVARCFG.STA_BAD;
ALDIS := DIVARCFG.STA_ALDIS;
DLNK := DIVARCFG.STA_DLNK;
ENBL := DIVARCFG.STA_ENBL;
ALM := DIVARCFG.STA_ALM;
VALPRV := DIVARCFG.STA_VALPRV;
WRN := DIVARCFG.STA_WRN;
INBUF := DIVARCFG.STA_INBUF;
FRC := DIVARCFG.STA_FRC;
SML := DIVARCFG.STA_SML;
CMDLOAD := DIVARCFG.STA_CMDLOAD;

PRM_ISALM := DIVARCFG.PRM_ISALM;
PRM_ISWRN := DIVARCFG.PRM_ISWRN;
PRM_INVERSE := DIVARCFG.PRM_INVERSE;
PRM_NRMVAL := DIVARCFG.PRM_NRMVAL;
PRM_QALENBL := DIVARCFG.PRM_QALENBL;
PRM_DSBL := DIVARCFG.PRM_DSBL;

INBUF := (DIVARCFG.ID = VARBUF.ID) AND (DIVARCFG.CLSID = VARBUF.CLSID);
CMDLOAD := DIVARHMI.STA.15;
CMD := 0;
DLNK := (CHCFG.ID &gt; 0);
VARENBL := NOT PRM_DSBL AND DLNK;
VRAW := CHCFG.STA_VALB;
T_STEPMS := DIVARCFG.T_STEP1;

(*ping-pong*)
IF DLNK THEN
    CHCFG.STA_PNG := true;
    CHCFG.VARID := DIVARCFG.ID;
END_IF;

IF NOT VARENBL THEN
    DIVARCFG.STA_VRAW := VRAW;
    DIVARCFG.T_STEP1 := 0;
    DIVARCFG.STEP1 := 400;
END_IF;

dT1 := PLCCFG.TQMS - DIVARCFG.T_PREV;

(* широкомовне дефорсування*) 
IF PLCCFG.CMD = 16#4302 THEN
    FRC := false; (*дефорсувати об'єкт типу*)
END_IF;

IF CMDLOAD THEN
    CMD := 16#0100;
ELSIF INBUF AND VARBUF.CMD &lt;&gt; 0 THEN
    CMD := VARBUF.CMD;
END_IF;

(*commands*)
CASE CMD OF
    16#0001: (*записати 1 - тільки при форсуванні*)
        IF FRC AND INBUF THEN
            DIVARCFG.VALI := 1;
            VAL := true;
            DIVARCFG.STEP1 := 401;
            DIVARCFG.T_STEP1 := 0;
        END_IF;
    16#0002: (*записати 0 - тільки при форсуванні*)
        IF FRC AND INBUF THEN
            DIVARCFG.VALI := 0;
            VAL := false;
            DIVARCFG.STEP1 := 400;
            DIVARCFG.T_STEP1 := 0;
        END_IF;
    16#0003: (*TOGGLE - тільки при форсуванні*)
        IF FRC AND INBUF THEN
            IF DIVARCFG.VALI &gt; 0 THEN
                DIVARCFG.VALI := 0;
                VAL := false;
                DIVARCFG.STEP1 := 400;
                DIVARCFG.T_STEP1 := 0;
            ELSE
                DIVARCFG.VALI := 1;
                VAL := true;
                DIVARCFG.STEP1 := 401;
                DIVARCFG.T_STEP1 := 0;
            END_IF;
        END_IF;
    16#0100: (*прочитати конфігурацію*)
        VARBUF.MSG := 201;
        VARBUF.PRM.0 := PRM_ISALM;
        VARBUF.PRM.1 := PRM_ISWRN;
        VARBUF.PRM.2 := PRM_INVERSE;
        VARBUF.PRM.5 := PRM_NRMVAL;
        VARBUF.PRM.6 := PRM_QALENBL;
        VARBUF.PRM.7 := PRM_DSBL;
        
        VARBUF.ID := DIVARCFG.ID;
        VARBUF.CLSID := DIVARCFG.CLSID;
        VARBUF.CHID := DIVARCFG.CHID;
        VARBUF.VALR := INT_TO_REAL(DIVARCFG.VALI);
        VARBUF.T_FLTSP := DIVARCFG.T_FLTSP;
        VARBUF.T_DEALL := DIVARCFG.T_DEASP;
        (*//VARBUF.STEP1 := DIVARCFG.STEP1;*)
        (*VARBUF.T_STEP1 := DIVARCFG.T_STEP1;*)
        
    16#0101: (*записати конфігурацію*)
                (* MSG 200-Ok 400-Error
            // 200 - Дані записані
            // 201 - Дані прочитані 
            // 403 - канал вже зайнятий 
            // 404 - номер каналу не відповідає діапазону   *)
        PRM_ISALM := VARBUF.PRM.0;
        PRM_ISWRN := VARBUF.PRM.1;
        PRM_INVERSE := VARBUF.PRM.2;
        PRM_NRMVAL := VARBUF.PRM.5;
        PRM_QALENBL := VARBUF.PRM.6;
        PRM_DSBL := VARBUF.PRM.7;

        VARBUF.MSG:=200; 
            IF VARBUF.CHID&gt;=0 AND VARBUF.CHID &lt;= INT_TO_UINT(PLCCFG.DICNT) THEN
                IF CHDI[VARBUF.CHID].VARID = 0 THEN 
                    DIVARCFG.CHID := VARBUF.CHID;
                ELSIF VARBUF.CHID &lt;&gt; DIVARCFG.CHID THEN 
                    VARBUF.MSG := 403;(* канал вже зайнятий*)
                END_IF;
            ELSE 
                VARBUF.MSG := 404; (*номер каналу не відповідає діапазону*)
            END_IF;

        IF INBUF THEN
            VARBUF.CHID := DIVARCFG.CHID;
        END_IF;
        DIVARCFG.T_FLTSP := VARBUF.T_FLTSP;
        DIVARCFG.T_DEASP := VARBUF.T_DEALL;
        
    16#0102: (*записати значення за замовченням*)
        DIVARCFG.CHID := DIVARCFG.CHIDDF;
        ;
    16#0300: (*перемкнути форсування*)
        FRC := NOT FRC;
    16#0301: (*форсувати один/усі об'єкти типу*)
        FRC := true;
    16#0302: (*дефорсувати один/усі об'єкти типу*)
        FRC := false;
    16#0311: (* імітувати*)
        SML := true;
    16#0312: (* зняти режим імітації*)
        SML := false;
    16#0400: (* запуск калібрування*)
        DIVARCFG.STA_ISALM := true;
END_CASE;

(*обробка значень*)
IF NOT FRC AND NOT SML THEN
    IF PRM_INVERSE THEN
        DI := NOT VRAW;
    ELSE
        DI := VRAW;
    END_IF;
    CASE DIVARCFG.STEP1 OF
        400:(*DI =0*)
            IF DI THEN
                DIVARCFG.STEP1 := 401;
                DIVARCFG.T_STEP1 := 0;
            END_IF;
            IF T_STEPMS &gt;= UINT_TO_UDINT(DIVARCFG.T_FLTSP) THEN
                VAL := FALSE;
            END_IF;
        401:(*DI =1*)
            IF NOT DI THEN
                DIVARCFG.STEP1 := 400;
                DIVARCFG.T_STEP1 := 0;
            END_IF;
            IF T_STEPMS &gt;= UINT_TO_UDINT(DIVARCFG.T_FLTSP) THEN
                VAL := true;
            END_IF;
        ELSE
            DIVARCFG.STEP1 := 400;
            DIVARCFG.T_STEP1 := 0;
    END_CASE;
    (*якщо це не DI з лічильником*)
    IF DIVARCFG.CLSID &lt;&gt; 16#1011 THEN
        DIVARCFG.VALI := BOOL_TO_INT (VAL);
    END_IF;
ELSE (* обробка без фільтрації та інверсії*) 
    IF FRC THEN  (*при форсування значення береться з VALI*)
        (*якщо це не DI з лічильником*)
        IF DIVARCFG.CLSID &lt;&gt; 16#1011 THEN
            VAL := INT_TO_BOOL (DIVARCFG.VALI);
        END_IF;
    ELSIF SML THEN (*в режимі імітації VAL змінюється ззовні а VALI береться з нього*)     
        (*якщо це не DI з лічильником*)
        IF DIVARCFG.CLSID &lt;&gt; 16#1011 THEN
            DIVARCFG.VALI := BOOL_TO_INT (VAL);
        END_IF;
    END_IF;
    CASE DIVARCFG.STEP1 OF
        400:(*DI =0*)
            IF VAL THEN
                DIVARCFG.STEP1 := 401;
                DIVARCFG.T_STEP1 := 0;
            END_IF;
        401:(*DI =1*)
            IF NOT VAL THEN
                DIVARCFG.STEP1 := 400;
                DIVARCFG.T_STEP1 := 0;
            END_IF;
        ELSE
            DIVARCFG.STEP1 := 400;
            DIVARCFG.T_STEP1 := 0;
    END_CASE;
END_IF;

(*обробка тривог*)
IF VARENBL AND DIVARCFG.T_STEP1 &gt;= UINT_TO_UDINT(DIVARCFG.T_DEASP) * 100 THEN
    ALM := NOT (PRM_NRMVAL = VAL) AND PRM_ISALM;
    WRN := NOT (PRM_NRMVAL = VAL) AND PRM_ISWRN;
ELSE
    ALM := false;
    WRN := false;
END_IF;

(*
//---------------------- робота з IoT буфером
//16#1011 - читання, 16#1012- запис
IF "IOTDB".IOTBUF.CMD = 16#1011 AND DIVARCFG.ID = "IOTDB".IOTBUF.ID THEN
   "IOTDB".IOTBUF.DIVAR := DIVARCFG; 
END_IF;
INIoTBUF:= "IOTDB".IOTBUF.ID = DIVARCFG.ID;
IF INIoTBUF THEN
    "IOTDB".IOTBUF.DIVAR.VALI := DIVARCFG.VALI;
    "IOTDB".IOTBUF.DIVAR.STA := DIVARCFG.STA;
    "IOTDB".IOTBUF.DIVAR.STEP1 := DIVARCFG.STEP1;
    "IOTDB".IOTBUF.DIVAR.T_STEP1 := DIVARCFG.T_STEP1;
END_IF;
//--------------------------------------------------
*)
BAD := CHCFG.STA_BAD AND PRM_QALENBL AND NOT SML;

IF BAD THEN
    PLCCFG.ALM_BAD := true;
    PLCCFG.CNTBAD := PLCCFG.CNTBAD + 1;
    IF NOT DIVARCFG.STA_BAD THEN
        PLCCFG.ALM_NWBAD := true;
    END_IF;
END_IF;

IF ALM THEN
    PLCCFG.ALM_ALM := true;
    PLCCFG.CNTALM := PLCCFG.CNTALM + 1;
    IF NOT DIVARCFG.STA_ALM THEN
        PLCCFG.ALM_NWALM := true;
    END_IF;
END_IF;
IF WRN THEN
    PLCCFG.ALM_WRN := true;
    PLCCFG.CNTWRN := PLCCFG.CNTWRN + 1;
    IF NOT DIVARCFG.STA_WRN THEN
        PLCCFG.ALM_NWWRN := true;
    END_IF;
END_IF;
IF FRC THEN
    PLCCFG.STA_FRC1 := true;
    PLCCFG.CNTFRC := PLCCFG.CNTFRC + 1;
END_IF;
IF SML THEN
    PLCCFG.STA_SML := true;
END_IF;


ISALM := PRM_ISALM;
ISWRN := PRM_ISWRN;

DIVARCFG.STA_VRAW := VRAW;
DIVARCFG.STA_VALB := VAL;
DIVARCFG.STA_BAD := BAD;
DIVARCFG.STA_ALDIS := ALDIS;
DIVARCFG.STA_DLNK := DLNK;
DIVARCFG.STA_ENBL := VARENBL;
DIVARCFG.STA_ALM := ALM;
DIVARCFG.STA_VALPRV := VALPRV;
DIVARCFG.STA_ISALM := ISALM;
(*DIVARCFG.STA := STA.SPDMONON;*)
DIVARCFG.STA_ISWRN := ISWRN;
DIVARCFG.STA_WRN := WRN;
DIVARCFG.STA_INBUF := INBUF;
DIVARCFG.STA_FRC := FRC;
DIVARCFG.STA_SML := SML;
DIVARCFG.STA_CMDLOAD := FALSE;

DIVARCFG.PRM_ISALM := PRM_ISALM;
DIVARCFG.PRM_ISWRN := PRM_ISWRN;
DIVARCFG.PRM_INVERSE := PRM_INVERSE;
DIVARCFG.PRM_NRMVAL := PRM_NRMVAL;
DIVARCFG.PRM_QALENBL := PRM_QALENBL;
DIVARCFG.PRM_DSBL := PRM_DSBL;

DIVARHMI.STA := DIVARCFG.STA;

DIVARCFG.T_PREV := PLCCFG.TQMS;

DIVARCFG.T_STEP1 := DIVARCFG.T_STEP1 + dT1;
IF DIVARCFG.T_STEP1 &gt; 16#7FFF_FFFF THEN
    DIVARCFG.T_STEP1 := 16#7FFF_FFFF;
END_IF;

IF INBUF THEN
    VARBUF.CMD := 0;
    VARBUF.VALR := INT_TO_REAL(DIVARCFG.VALI);
    VARBUF.STA := DIVARCFG.STA;
    VARBUF.STEP1 := DIVARCFG.STEP1;
    VARBUF.T_STEP1 := DIVARCFG.T_STEP1;

    VARBUF.CH_CLSID := CHCFG.CLSID;
    VARBUF.CH_STA.0 := CHCFG.STA_VRAW;
    VARBUF.CH_STA.1 := CHCFG.STA_VALB;
    VARBUF.CH_STA.2 := CHCFG.STA_BAD;
    VARBUF.CH_STA.3 := CHCFG.STA_b3;
    VARBUF.CH_STA.4 := CHCFG.STA_PNG;
    VARBUF.CH_STA.5 := CHCFG.STA_ULNK;
    VARBUF.CH_STA.6 := CHCFG.STA_MERR;
    VARBUF.CH_STA.7 := CHCFG.STA_BRK;
    VARBUF.CH_STA.8 := CHCFG.STA_SHRT;
    VARBUF.CH_STA.9 := CHCFG.STA_NBD;
    VARBUF.CH_STA.10 := CHCFG.STA_b10;
    VARBUF.CH_STA.11 := CHCFG.STA_INIOTBUF;
    VARBUF.CH_STA.12 := CHCFG.STA_INBUF;
    VARBUF.CH_STA.13 := CHCFG.STA_FRC;
    VARBUF.CH_STA.14 := CHCFG.STA_SML;
    VARBUF.CH_STA.15 := CHCFG.STA_CMDLOAD;
END_IF;


</STSource>
		</FBProgram>
	</FBSource>
	<DDTSource DDTName="DIVAR_CFG" version="0.03" dateTime="dt#2022-01-16-19:31:46">
		<attribute name="TypeSignatureCheckSumString" value="B758"></attribute>
		<structure>
			<variables name="ID" typeName="UINT">
				<comment>Унікальний ідентифікатор</comment>
			</variables>
			<variables name="CLSID" typeName="UINT">
				<comment>16#1010</comment>
			</variables>
			<variables name="STA" typeName="INT">
				<comment>статус (див STC)</comment>
			</variables>
			<variables name="STA_VRAW" typeName="BOOL">
				<comment>=1 – значення дискретного сигналу з DICH</comment>
				<attribute name="ExtractBit" value="0"></attribute>
			</variables>
			<variables name="STA_VALB" typeName="BOOL">
				<comment>=1 – значення дискретної вхідної змінної після всіх перетворень, в режимі FRC=1 може змінюватися із-зовні</comment>
				<attribute name="ExtractBit" value="1"></attribute>
			</variables>
			<variables name="STA_BAD" typeName="BOOL">
				<comment>=1 - Дані недостовірні {A.BAD.2}</comment>
				<attribute name="ExtractBit" value="2"></attribute>
			</variables>
			<variables name="STA_ALDIS" typeName="BOOL">
				<comment>=1 - Тривога виведена з експлуатації {A.MSG.3}</comment>
				<attribute name="ExtractBit" value="3"></attribute>
			</variables>
			<variables name="STA_DLNK" typeName="BOOL">
				<comment>=1 – якщо прив’язаний до каналу</comment>
				<attribute name="ExtractBit" value="4"></attribute>
			</variables>
			<variables name="STA_ENBL" typeName="BOOL">
				<comment>=1 – змінна задіяна  = (NOT PRM.7 AND  DLNK)</comment>
				<attribute name="ExtractBit" value="5"></attribute>
			</variables>
			<variables name="STA_ALM" typeName="BOOL">
				<comment>=1 - Тривога {A.ALM.6}</comment>
				<attribute name="ExtractBit" value="6"></attribute>
			</variables>
			<variables name="STA_VALPRV" typeName="BOOL">
				<comment>значення на попередньому циклі</comment>
				<attribute name="ExtractBit" value="7"></attribute>
			</variables>
			<variables name="STA_ISALM" typeName="BOOL">
				<comment>=1 - задіяна тривога </comment>
				<attribute name="ExtractBit" value="8"></attribute>
			</variables>
			<variables name="SPDMONON" typeName="BOOL">
				<comment>=1 - включений контроль швидкості (SPDMON) </comment>
				<attribute name="ExtractBit" value="9"></attribute>
			</variables>
			<variables name="STA_ISWRN" typeName="BOOL">
				<comment>=1 - задіяне попередження</comment>
				<attribute name="ExtractBit" value="10"></attribute>
			</variables>
			<variables name="STA_WRN" typeName="BOOL">
				<comment>=1 - Попередження {A.ALM.11}</comment>
				<attribute name="ExtractBit" value="11"></attribute>
			</variables>
			<variables name="STA_INBUF" typeName="BOOL">
				<comment>=1 – змінна в буфері</comment>
				<attribute name="ExtractBit" value="12"></attribute>
			</variables>
			<variables name="STA_FRC" typeName="BOOL">
				<comment>=1 - Режим форсування{A.MSG.13}</comment>
				<attribute name="ExtractBit" value="13"></attribute>
			</variables>
			<variables name="STA_SML" typeName="BOOL">
				<comment>=1 – змінна в режимі симуляції</comment>
				<attribute name="ExtractBit" value="14"></attribute>
			</variables>
			<variables name="STA_CMDLOAD" typeName="BOOL">
				<comment>=1 – команда завантаження в буфер</comment>
				<attribute name="ExtractBit" value="15"></attribute>
			</variables>
			<variables name="VALI" typeName="INT">
				<comment>для відображення значення при не форсуванні, використовується для введення значення з буфера при форсуванні</comment>
			</variables>
			<variables name="PRM" typeName="INT">
				<comment>параметри</comment>
			</variables>
			<variables name="PRM_ISALM" typeName="BOOL">
				<comment>=1 – задіяти як технологічну тривогу</comment>
				<attribute name="ExtractBit" value="0"></attribute>
			</variables>
			<variables name="PRM_ISWRN" typeName="BOOL">
				<comment>=1 – задіяти як технологічне попередження</comment>
				<attribute name="ExtractBit" value="1"></attribute>
			</variables>
			<variables name="PRM_INVERSE" typeName="BOOL">
				<comment>=1 – інвертувати сире значення</comment>
				<attribute name="ExtractBit" value="2"></attribute>
			</variables>
			<variables name="PRM_b3" typeName="BOOL">
				<attribute name="ExtractBit" value="3"></attribute>
			</variables>
			<variables name="PRM_b4" typeName="BOOL">
				<attribute name="ExtractBit" value="4"></attribute>
			</variables>
			<variables name="PRM_NRMVAL" typeName="BOOL">
				<comment>значення норми</comment>
				<attribute name="ExtractBit" value="5"></attribute>
			</variables>
			<variables name="PRM_QALENBL" typeName="BOOL">
				<comment>=1 – задіяти тривогу недостовірності каналу</comment>
				<attribute name="ExtractBit" value="6"></attribute>
			</variables>
			<variables name="PRM_DSBL" typeName="BOOL">
				<comment>=1 – змінна не задіяна</comment>
				<attribute name="ExtractBit" value="7"></attribute>
			</variables>
			<variables name="PRM_SPEEDENBL" typeName="BOOL">
				<comment>=1 – активація блоку розрахунку швидкості</comment>
				<attribute name="ExtractBit" value="8"></attribute>
			</variables>
			<variables name="PRM_b9" typeName="BOOL">
				<attribute name="ExtractBit" value="9"></attribute>
			</variables>
			<variables name="PRM_b10" typeName="BOOL">
				<attribute name="ExtractBit" value="10"></attribute>
			</variables>
			<variables name="PRM_b11" typeName="BOOL">
				<attribute name="ExtractBit" value="11"></attribute>
			</variables>
			<variables name="PRM_b12" typeName="BOOL">
				<attribute name="ExtractBit" value="12"></attribute>
			</variables>
			<variables name="PRM_b13" typeName="BOOL">
				<attribute name="ExtractBit" value="13"></attribute>
			</variables>
			<variables name="PRM_b14" typeName="BOOL">
				<attribute name="ExtractBit" value="14"></attribute>
			</variables>
			<variables name="PRM_b15" typeName="BOOL">
				<attribute name="ExtractBit" value="15"></attribute>
			</variables>
			<variables name="CHID" typeName="UINT">
				<comment>Логічний номер дискретного каналу</comment>
			</variables>
			<variables name="STEP1" typeName="UINT">
				<comment>номер кроку</comment>
			</variables>
			<variables name="T_DEASP" typeName="UINT">
				<comment>Час затримки тривоги в 0.1 секундах</comment>
			</variables>
			<variables name="T_FLTSP" typeName="UINT">
				<comment>Заданий час фільтрації в мілісекундах</comment>
			</variables>
			<variables name="CHIDDF" typeName="UINT">
				<comment>Логічний номер дискретного каналу за замовченням</comment>
			</variables>
			<variables name="T_STEP1" typeName="UDINT">
				<comment>Плинний час кроку в мс</comment>
			</variables>
			<variables name="T_PREV" typeName="UDINT">
				<comment>час в мс з попереднього виклику, береться зі структури PLC_CFG.TQMS</comment>
			</variables>
		</structure>
	</DDTSource>
	<DDTSource DDTName="DIVAR_HMI" version="0.01" dateTime="dt#2022-01-06-17:23:59">
		<attribute name="TypeSignatureCheckSumString" value="7BFE"></attribute>
		<structure>
			<variables name="STA" typeName="INT">
				<comment>статус</comment>
			</variables>
		</structure>
	</DDTSource>
	<FBSource nameOfFBType="DOVARFN" version="0.09" dateTime="dt#2022-01-16-20:07:15">
		<attribute name="TypeCodeCheckSumString" value="C73A"></attribute>
		<attribute name="TypeSignatureCheckSumString" value="6B8A"></attribute>
		<inOutParameters>
			<variables name="CHCFG" typeName="CH_CFG">
				<attribute name="PositionPin" value="1"></attribute>
			</variables>
			<variables name="DOVARCFG" typeName="DOVAR_CFG">
				<attribute name="PositionPin" value="2"></attribute>
			</variables>
			<variables name="DOVARHMI" typeName="DOVAR_HMI">
				<attribute name="PositionPin" value="3"></attribute>
			</variables>
			<variables name="VARBUF" typeName="VARBUF">
				<attribute name="PositionPin" value="4"></attribute>
			</variables>
			<variables name="PLCCFG" typeName="PLC_CFG">
				<attribute name="PositionPin" value="5"></attribute>
			</variables>
			<variables name="CHDO" typeName="ARRAY[0..32] OF CH_CFG">
				<attribute name="PositionPin" value="6"></attribute>
			</variables>
		</inOutParameters>
		<privateLocalVariables>
			<variables name="VRAW" typeName="BOOL"></variables>
			<variables name="VAL" typeName="BOOL"></variables>
			<variables name="BAD" typeName="BOOL"></variables>
			<variables name="DLNK" typeName="BOOL"></variables>
			<variables name="ENBL" typeName="BOOL"></variables>
			<variables name="VALPRV" typeName="BOOL"></variables>
			<variables name="MVAL" typeName="BOOL"></variables>
			<variables name="INBUF" typeName="BOOL"></variables>
			<variables name="FRC" typeName="BOOL"></variables>
			<variables name="SML" typeName="BOOL"></variables>
			<variables name="PRM_INVERSE" typeName="BOOL"></variables>
			<variables name="PRM_QALENBL" typeName="BOOL"></variables>
			<variables name="PRM_DSBL" typeName="BOOL"></variables>
			<variables name="CMDLOAD" typeName="BOOL"></variables>
			<variables name="CMD" typeName="UINT"></variables>
			<variables name="VARENBL" typeName="BOOL"></variables>
			<variables name="T_STEPMS" typeName="UDINT"></variables>
			<variables name="dT1" typeName="UDINT"></variables>
		</privateLocalVariables>
		<FBProgram name="DOVARFN">
			<STSource>IF PLCCFG.STA_SCN1 THEN
    DOVARCFG.CLSID := 16#1020;
    DOVARCFG.PRM_DSBL := FALSE;
    DOVARCFG.T_PREV := PLCCFG.TQMS;
    IF DOVARCFG.CHID = 0 THEN
        DOVARCFG.CHID := DOVARCFG.CHIDDF;
    END_IF;
    IF CHCFG.ID &gt; 0 THEN
        CHCFG.STA_VALB := DOVARCFG.STA_VALB;
    ELSE
        CHCFG.STA_VALB := 0;
    END_IF;
    DOVARCFG.T_STEP1 := 0;
    DOVARCFG.STEP1 := 400;
    RETURN;
END_IF;



VRAW := DOVARCFG.STA_VRAW;
VAL := DOVARCFG.STA_VALB;
BAD := DOVARCFG.STA_BAD;
DLNK := DOVARCFG.STA_DLNK;
ENBL := DOVARCFG.STA_ENBL;
VALPRV := DOVARCFG.STA_VALPRV;
MVAL := DOVARCFG.STA_MVAL;
INBUF := DOVARCFG.STA_INBUF;
FRC := DOVARCFG.STA_FRC;
SML := DOVARCFG.STA_SML;
CMDLOAD := DOVARCFG.STA_CMDLOAD;

PRM_INVERSE := DOVARCFG.PRM_INVERSE;
PRM_QALENBL := DOVARCFG.PRM_QALENBL;
PRM_DSBL := DOVARCFG.PRM_DSBL;

INBUF := (DOVARCFG.ID = VARBUF.ID) AND (DOVARCFG.CLSID = VARBUF.CLSID);
CMDLOAD := DOVARHMI.STA.15;
CMD := 0;
DLNK := (CHCFG.ID &gt; 0);
VARENBL := NOT PRM_DSBL AND DLNK;
VRAW := CHCFG.STA_VALB;
T_STEPMS := DOVARCFG.T_STEP1;

(*ping-pong*)
IF DLNK THEN
    CHCFG.STA_PNG := true;
    CHCFG.VARID := DOVARCFG.ID;
END_IF;

IF NOT VARENBL THEN
    (*  DOVARCFG.STA.VRAW := VRAW;*)
    DOVARCFG.T_STEP1 := 0;
    DOVARCFG.STEP1 := 400;
END_IF;

dT1 := PLCCFG.TQMS - DOVARCFG.T_PREV;

(* широкомовне дефорсування*) 
IF PLCCFG.CMD = 16#4302 THEN
    FRC := false; (*дефорсувати об'єкт типу*)
END_IF;

IF CMDLOAD THEN
    CMD := 16#0100;
ELSIF INBUF AND VARBUF.CMD &lt;&gt; 0 THEN
    CMD := VARBUF.CMD;
END_IF;

(*commands*)
CASE CMD OF
    16#0001: (*записати 1*)
        IF FRC AND INBUF THEN
            DOVARCFG.VALI := 1;
            VARBUF.VALR:=1.0;
            VAL := true;
            DOVARCFG.STEP1 := 401;
            DOVARCFG.T_STEP1 := 0;
        END_IF;
    16#0002: (*записати 0*)
        IF FRC AND INBUF THEN
            DOVARCFG.VALI := 0;
            VARBUF.VALR:=0.0;
            VAL := false;
            DOVARCFG.STEP1 := 400;
            DOVARCFG.T_STEP1 := 0;
        END_IF;
    16#0003: (*TOGGLE*)
        IF FRC AND INBUF THEN
            IF DOVARCFG.VALI &gt; 0 THEN
                DOVARCFG.VALI := 0;
                VARBUF.VALR:=0.0;
                VAL := false;
                DOVARCFG.STEP1 := 400;
                DOVARCFG.T_STEP1 := 0;
            ELSE
                DOVARCFG.VALI := 1;
                VARBUF.VALR:=1.0;
                VAL := true;
                DOVARCFG.STEP1 := 401;
                DOVARCFG.T_STEP1 := 0;
            END_IF;
        END_IF;
    16#0100: (*прочитати конфігурацію*)
        VARBUF.MSG:=201; 
        VARBUF.PRM.2 := PRM_INVERSE;
        VARBUF.PRM.6 := PRM_QALENBL;
        VARBUF.PRM.7 := PRM_DSBL;
        
        VARBUF.ID := DOVARCFG.ID;
        VARBUF.CLSID := DOVARCFG.CLSID;
        VARBUF.CHID := DOVARCFG.CHID;
        VARBUF.VALR := INT_TO_REAL(DOVARCFG.VALI);
        (*VARBUF.STEP1 := DIVARCFG.STEP1;*)
        (*VARBUF.T_STEP1 := DIVARCFG.T_STEP1;*)
        
    16#0101: (*записати конфігурацію*)
                (* MSG 200-Ok 400-Error
            // 200 - Дані записані
            // 201 - Дані прочитані 
            // 403 - канал вже зайнятий 
            // 404 - номер каналу не відповідає діапазону   *)
        PRM_INVERSE := VARBUF.PRM.2;
        PRM_QALENBL := VARBUF.PRM.6;
        PRM_DSBL := VARBUF.PRM.7;
        (*перевіряти незайнятість каналу треба в функції контролю буферу *)
        
        VARBUF.MSG:=200; 
            IF VARBUF.CHID&gt;=0 AND VARBUF.CHID &lt;= INT_TO_UINT(PLCCFG.DOCNT) THEN
                IF CHDO[VARBUF.CHID].VARID = 0 THEN 
                    DOVARCFG.CHID := VARBUF.CHID;
                ELSIF VARBUF.CHID &lt;&gt; DOVARCFG.CHID THEN 
                    VARBUF.MSG := 403;(* канал вже зайнятий*)
                END_IF;
            ELSE 
                VARBUF.MSG := 404; (*номер каналу не відповідає діапазону*)
            END_IF;

        IF INBUF THEN
            VARBUF.CHID := DOVARCFG.CHID;
        END_IF;
        
        
    16#0102: (*записати значення за замовченням*)
        DOVARCFG.CHID := DOVARCFG.CHIDDF;
        ;
    16#0300: (*перемкнути форсування*)
        FRC := NOT FRC;
    16#0301: (*форсувати один/усі об'єкти типу*)
        FRC := true;
    16#0302: (*дефорсувати один/усі об'єкти типу*)
        FRC := false;
    16#0311: (* імітувати*)
        SML := true;
    16#0312: (* зняти режим імітації*)
        SML := false;
END_CASE;

(*val*)
IF FRC THEN (*режим форсування*)
    IF INBUF THEN
        DOVARCFG.VALI := REAL_TO_INT(VARBUF.VALR);
    END_IF;
    VAL := DOVARCFG.VALI &gt; 0;
    IF VAL THEN
        DOVARCFG.STEP1 := 401;
    ELSE
        DOVARCFG.STEP1 := 400;
    END_IF;
ELSE
    IF VAL THEN
        DOVARCFG.VALI := 1;
        DOVARCFG.STEP1 := 401;
    ELSE
        DOVARCFG.VALI := 0;
        DOVARCFG.STEP1 := 400;
    END_IF;
END_IF;

(*фронт*)
IF VAL &lt;&gt; VALPRV THEN
    DOVARCFG.T_STEP1 := 0;
END_IF;

IF VARENBL THEN
    IF PRM_INVERSE THEN
        VRAW := NOT VAL;
    ELSE
        VRAW := VAL;
    END_IF;
    IF NOT SML THEN
        CHCFG.STA_VALB := VRAW;
    END_IF;(* режим симуляції - вихідне значення не змінюється *)
END_IF;

(*недостовірність каналу*)
BAD := CHCFG.STA_BAD AND PRM_QALENBL AND VARENBL AND NOT SML;

IF BAD THEN
    PLCCFG.ALM_BAD := true;
    PLCCFG.CNTBAD := PLCCFG.CNTBAD + 1;
    IF NOT DOVARCFG.STA_BAD THEN
        PLCCFG.ALM_NWBAD := true;
    END_IF;
END_IF;
IF FRC THEN
    PLCCFG.STA_FRC1 := true;
    PLCCFG.CNTFRC := PLCCFG.CNTFRC + 1;
END_IF;
IF SML THEN
    PLCCFG.STA_SML := true;
END_IF;

DOVARCFG.STA_VRAW := VRAW;
DOVARCFG.STA_VALB := VAL;
DOVARCFG.STA_BAD := BAD;
DOVARCFG.STA_DLNK := DLNK;
DOVARCFG.STA_ENBL :=  VARENBL;
DOVARCFG.STA_VALPRV:=VAL;
DOVARCFG.STA_MVAL := DOVARCFG.VALI &gt; 0;
DOVARCFG.STA_INBUF := INBUF;
DOVARCFG.STA_FRC := FRC;
DOVARCFG.STA_SML := SML;
DOVARCFG.STA_CMDLOAD := FALSE;

DOVARCFG.PRM_INVERSE := PRM_INVERSE;
DOVARCFG.PRM_QALENBL := PRM_QALENBL;
DOVARCFG.PRM_DSBL := PRM_DSBL;

DOVARHMI.STA := DOVARCFG.STA;

DOVARCFG.T_PREV := PLCCFG.TQMS;

DOVARCFG.T_STEP1 := DOVARCFG.T_STEP1 + dT1;
IF DOVARCFG.T_STEP1 &gt; 16#7FFF_FFFF THEN
    DOVARCFG.T_STEP1 := 16#7FFF_FFFF;
END_IF;

IF INBUF THEN
    VARBUF.CMD := 0;
    VARBUF.VALR := INT_TO_REAL(DOVARCFG.VALI);
    VARBUF.STA := DOVARCFG.STA;
    VARBUF.STEP1 := DOVARCFG.STEP1;
    VARBUF.T_STEP1 := DOVARCFG.T_STEP1;

    VARBUF.CH_CLSID := CHCFG.CLSID;
    VARBUF.CH_STA.0 := CHCFG.STA_VRAW;
    VARBUF.CH_STA.1 := CHCFG.STA_VALB;
    VARBUF.CH_STA.2 := CHCFG.STA_BAD;
    VARBUF.CH_STA.3 := CHCFG.STA_b3;
    VARBUF.CH_STA.4 := CHCFG.STA_PNG;
    VARBUF.CH_STA.5 := CHCFG.STA_ULNK;
    VARBUF.CH_STA.6 := CHCFG.STA_MERR;
    VARBUF.CH_STA.7 := CHCFG.STA_BRK;
    VARBUF.CH_STA.8 := CHCFG.STA_SHRT;
    VARBUF.CH_STA.9 := CHCFG.STA_NBD;
    VARBUF.CH_STA.10 := CHCFG.STA_b10;
    VARBUF.CH_STA.11 := CHCFG.STA_INIOTBUF;
    VARBUF.CH_STA.12 := CHCFG.STA_INBUF;
    VARBUF.CH_STA.13 := CHCFG.STA_FRC;
    VARBUF.CH_STA.14 := CHCFG.STA_SML;
    VARBUF.CH_STA.15 := CHCFG.STA_CMDLOAD;
END_IF;

</STSource>
		</FBProgram>
	</FBSource>
	<DDTSource DDTName="DOVAR_CFG" version="0.02" dateTime="dt#2022-01-16-19:58:50">
		<attribute name="TypeSignatureCheckSumString" value="757F"></attribute>
		<structure>
			<variables name="ID" typeName="UINT">
				<comment>Унікальний ідентифікатор</comment>
			</variables>
			<variables name="CLSID" typeName="UINT">
				<comment>16#1010</comment>
			</variables>
			<variables name="STA" typeName="INT">
				<comment>статус (див STC)</comment>
			</variables>
			<variables name="STA_VRAW" typeName="BOOL">
				<comment>=1 – значення дискретного сигналу з DOCH</comment>
				<attribute name="ExtractBit" value="0"></attribute>
			</variables>
			<variables name="STA_VALB" typeName="BOOL">
				<comment>=1 – значення дискретної вихідної змінної після всіх перетворень, в режимі FRC=1 може змінюватися із-зовні</comment>
				<attribute name="ExtractBit" value="1"></attribute>
			</variables>
			<variables name="STA_BAD" typeName="BOOL">
				<comment>=1 – Дані недостовірні {A.BAD.2}</comment>
				<attribute name="ExtractBit" value="2"></attribute>
			</variables>
			<variables name="STA_ALDIS" typeName="BOOL">
				<comment>=1 - Тривога виведена з експлуатації {A.MSG.3}</comment>
				<attribute name="ExtractBit" value="3"></attribute>
			</variables>
			<variables name="STA_DLNK" typeName="BOOL">
				<comment>=1 – якщо прив’язаний до каналу</comment>
				<attribute name="ExtractBit" value="4"></attribute>
			</variables>
			<variables name="STA_ENBL" typeName="BOOL">
				<comment>=1 – змінна задіяна = (NOT PRM.7 AND DLNK)</comment>
				<attribute name="ExtractBit" value="5"></attribute>
			</variables>
			<variables name="STA_b6" typeName="BOOL">
				<attribute name="ExtractBit" value="6"></attribute>
			</variables>
			<variables name="STA_VALPRV" typeName="BOOL">
				<comment>значення на попередньому циклі</comment>
				<attribute name="ExtractBit" value="7"></attribute>
			</variables>
			<variables name="STA_b8" typeName="BOOL">
				<attribute name="ExtractBit" value="8"></attribute>
			</variables>
			<variables name="STA_MVAL" typeName="BOOL">
				<comment>=1 – ручне (форсоване) значення</comment>
				<attribute name="ExtractBit" value="9"></attribute>
			</variables>
			<variables name="STA_b10" typeName="BOOL">
				<attribute name="ExtractBit" value="10"></attribute>
			</variables>
			<variables name="STA_b11" typeName="BOOL">
				<attribute name="ExtractBit" value="11"></attribute>
			</variables>
			<variables name="STA_INBUF" typeName="BOOL">
				<comment>=1 – змінна в буфері</comment>
				<attribute name="ExtractBit" value="12"></attribute>
			</variables>
			<variables name="STA_FRC" typeName="BOOL">
				<comment>=1 - Режим форсування{A.MSG.13}</comment>
				<attribute name="ExtractBit" value="13"></attribute>
			</variables>
			<variables name="STA_SML" typeName="BOOL">
				<comment>=1 – змінна в режимі симуляції</comment>
				<attribute name="ExtractBit" value="14"></attribute>
			</variables>
			<variables name="STA_CMDLOAD" typeName="BOOL">
				<comment>=1 – команда завантаження в буфер</comment>
				<attribute name="ExtractBit" value="15"></attribute>
			</variables>
			<variables name="VALI" typeName="INT">
				<comment>для відображення значення при не форсуванні, використовується для введення значення з буфера при форсуванні</comment>
			</variables>
			<variables name="PRM" typeName="INT">
				<comment>параметри</comment>
			</variables>
			<variables name="PRM_b0" typeName="BOOL">
				<attribute name="ExtractBit" value="0"></attribute>
			</variables>
			<variables name="PRM_b1" typeName="BOOL">
				<attribute name="ExtractBit" value="1"></attribute>
			</variables>
			<variables name="PRM_INVERSE" typeName="BOOL">
				<comment>=1 – інвертувати сире значення</comment>
				<attribute name="ExtractBit" value="2"></attribute>
			</variables>
			<variables name="PRM_b3" typeName="BOOL">
				<attribute name="ExtractBit" value="3"></attribute>
			</variables>
			<variables name="PRM_b4" typeName="BOOL">
				<attribute name="ExtractBit" value="4"></attribute>
			</variables>
			<variables name="PRM_b5" typeName="BOOL">
				<attribute name="ExtractBit" value="5"></attribute>
			</variables>
			<variables name="PRM_QALENBL" typeName="BOOL">
				<comment>=1 – задіяти тривогу недостовірності каналу</comment>
				<attribute name="ExtractBit" value="6"></attribute>
			</variables>
			<variables name="PRM_DSBL" typeName="BOOL">
				<comment>=1 – змінна не задіяна</comment>
				<attribute name="ExtractBit" value="7"></attribute>
			</variables>
			<variables name="PRM_b8" typeName="BOOL">
				<attribute name="ExtractBit" value="8"></attribute>
			</variables>
			<variables name="PRM_b9" typeName="BOOL">
				<attribute name="ExtractBit" value="9"></attribute>
			</variables>
			<variables name="PRM_b10" typeName="BOOL">
				<attribute name="ExtractBit" value="10"></attribute>
			</variables>
			<variables name="PRM_b11" typeName="BOOL">
				<attribute name="ExtractBit" value="11"></attribute>
			</variables>
			<variables name="PRM_b12" typeName="BOOL">
				<attribute name="ExtractBit" value="12"></attribute>
			</variables>
			<variables name="PRM_b13" typeName="BOOL">
				<attribute name="ExtractBit" value="13"></attribute>
			</variables>
			<variables name="PRM_b14" typeName="BOOL">
				<attribute name="ExtractBit" value="14"></attribute>
			</variables>
			<variables name="PRM_b15" typeName="BOOL">
				<attribute name="ExtractBit" value="15"></attribute>
			</variables>
			<variables name="CHID" typeName="UINT">
				<comment>Логічний номер дискретного каналу</comment>
			</variables>
			<variables name="CHIDDF" typeName="UINT">
				<comment>Логічний номер дискретного каналу за замовченням</comment>
			</variables>
			<variables name="STEP1" typeName="UINT">
				<comment>номер кроку</comment>
			</variables>
			<variables name="T_STEP1" typeName="UDINT">
				<comment>Плинний час кроку в мс</comment>
			</variables>
			<variables name="T_PREV" typeName="UDINT">
				<comment>час в мс з попереднього виклику, береться зі структури PLC_CFG.TQMS</comment>
			</variables>
		</structure>
	</DDTSource>
	<DDTSource DDTName="DOVAR_HMI" version="0.01" dateTime="dt#2022-01-06-17:24:59">
		<attribute name="TypeSignatureCheckSumString" value="7BFE"></attribute>
		<structure>
			<variables name="STA" typeName="INT">
				<comment>статус</comment>
			</variables>
		</structure>
	</DDTSource>
</VariablesExchangeFile>
