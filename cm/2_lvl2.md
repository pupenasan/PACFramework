## 2.4. Класи LVL2 (CLSID=16#200x – 16#27FF)
### 2.4.2. Класи VLVD: клапани з дискретним керуванням (CLSID=16#201x)
Датчики та сигнали керування ВМ подаються як змінні DIVAR та DOVAR; ті які не використовуються – подаються як пусті (з індексом 0); наявність/відсутність певних датчиків кінцевого положення та сигналів керування означується параметрами.
Функція класів розрахована для:

- Моностабільного (PRM.BISTABLE=0, CLSID=16#2011) режиму: одна вихідна змінна на клапан "відкрити";
- Бістабільного (PRM. BISTABLE =1, CLSID=16#2012) режиму: дві вихідні змінні "відкрити" та "закрити". Режим визначається автоматично при наявності 0-го індексу у одній з вихідних змінних.

У моностабільному режимі, вихідна змінна крану "відкрити" змінюється тільки при надходженні команд. На вихідну змінну "закрити" відправляється інверсна команда. Наприклад, команда "відкрити" переводить в "1" змінну на клапан "відкрити" тільки при надходженні команди. У бістабільному режимі вихідні змінні клапану можуть змінюватися при спрацюванні датчиків кінцевого положення: наприклад, кінцевик відкритості знімає "1" зі змінної відкриття.
У автоматичному незаблокованому режимі, значення вихідних змінних на ВМ змінюється алгоритмом тільки при наявності відповідних команд з програм. Іншими словами вихідні змінні можуть керуватися як в командному режимі на клапан (імпульсні команди відкрити/закрити) з програм так і байпасуватися зовнішніми алгоритмами. У ручному або заблокованому режимі, виходи міняються тільки командами з HMI (може змінитися в залежності від вимог процесу).
Передбачаються два режими конфігурування (MANCFG): ручне і автоматичне. У ручному режимі тип клапану та наявність кінцевих вимикачів задається бітовими параметрами PRM.BISTABLE, PRM.ZOPNENBL та PRM.ZCLSENBL. У автоматичному режимі ці параметри змінюються автоматично при прив'язці до змінних з ID=0 або їх підключеності. Таким чином, наприклад, при виходу з ладу датчика кінцевого положення, його можна тимчасово відключити в конфігурації (вивести з експлуатації для відключення генерування тривог), і клапан автоматично перейде в режим роботи без даного кінцевика. Ручне конфігурування типу клапану поки не знайшло свого використання.
#### VLVD_HMI
| Атрибут | Тип  | Біт           | Опис                                                         |
| ------- | ---- | ------------- | ------------------------------------------------------------ |
| STA     | UINT | 0 ALMOPN      | =1 Не відкрився (скидається при зміні команди або стану) датчика) |
|         |      | 1 ALMCLS      | =1 Не закрився (скидається при зміні команди або стану) датчика) |
|         |      | 2 BLCK        | =1 Заблокований                                              |
|         |      | 3 ALMSHFT     | =1 Порушення стану                                           |
|         |      | 4 SLNDBRK     | =1 Помилка датчику                                           |
|         |      | 5 OPNING      | =1 Відкривається                                             |
|         |      | 6 CLSING      | =1 Закривається                                              |
|         |      | 7 OPNED       | =1 Відкритий (16#0080)                                       |
|         |      | 8 CLSED       | =1 Закритий (16#0100)                                        |
|         |      | 9 DISP        | =1 дистанційний режим (з ПК/ОП) (16#0200)                    |
|         |      | 10 MANBX      | =1 Ручний зі щита                                            |
|         |      | 11 SLNDKZ/ALM | =1 КЗ соленоїду / загальна тривога                           |
|         |      | 12 INBUF      | =1 клапан в буфері                                           |
|         |      | 13 FRC        | =1 хоча би одна зі змінних в об’єкті форсована (для зручності відображення при наладці) |
|         |      | 14 SML        |                                                              |
|         |      | 15 CMDACK     |                                                              |
| CMD     | UINT |               | Команди:<br/>16#0001 – CMD_OPN<br/>16#0002 – CMD_CLS<br/>16#0003 – CMD_TOGGLE (перемикання, тільки для моностабільних клапанів)<br/>16#0004 – CMD_ALMACK<br/>16#0007 – CMD_BLCK (блокування)<br/>16#0008 – CMD_DBLK (деблокування)<br/><br/>16#0010 – CMD_STOPTUN<br/>16#0011 – CMD_TUNING (автопідстройка)<br/><br/>16#0100 – прочитати конфігурацію <br/>16#0101 – записати конфігурацію<br/>16#0102 – записати конфігурацію за замовченням<br/>16#4102 – записати конфігурацію за замовченням для усіх клапанів<br/><br/>16#0200 – тимчасово вивести тривогу з експлуатації<br/>16#0201 – ввести тривогу в експлуатацію<br/>16#0202 – підтвердити тривогу<br/>16#0300 – ручний/автомат<br/>16#0301 – ручний<br/>16#0302 – автомат<br/><br/>16#4301 – перевести в ручний усі об’єкти типу<br/>16#4302 – перевести в автомат усі об’єкти типу |

#### VLVD_CFG
| Атрибут | Тип  | Біт        | Опис                                                         | Зміщення |
| ------- | ---- | ---------- | ------------------------------------------------------------ | -------- |
| ID      |      |            |                                                              | 0        |
| CLSID   |      |            | 16#2011 – одно стабільний режим <br/>16#2012 – бістабільний режим | 1        |
| STA     |      |            |                                                              |          |
| CMD     |      |            |                                                              |          |
| PRM     | UINT | b0         |                                                              | 3        |
|         |      | b1         |                                                              |          |
|         |      | 2 ZOPNENBL | X2 - =1 є датчик відкритості                                 |          |
|         |      | 3 ZCLSENBL | X3 - =1 є датчик закритості                                  |          |
|         |      | 4 BISTABLE | X4 - =1                                                      |          |
|         |      | b5         | X5 – =1 клапан без нормального положення (додатково використовується  змінна  "закрити") |          |
|         |      | 6 MANCFG   | X6 – =1 ручне конфігурування типу клапану та типу керування (при зміні клапану в режимі роботи) |          |
|         |      | b7         | X7 – =1, використання клапану (0 – резерв)                   |          |
|         |      | 8 AUTOACK  | X8 - =1, автоматичне підтвердження тривог                    |          |
|         |      | b9         |                                                              |          |
|         |      | b10        |                                                              |          |
|         |      | b11        |                                                              |          |
|         |      | b12        |                                                              |          |
|         |      | b13        |                                                              |          |
|         |      | b14        |                                                              |          |
|         |      | b15        |                                                              |          |
| MSG     | UINT |            | Номер останнього діагностичного повідомлення                 |          |
| TDEASP  | UINT |            | Час затримки тривоги в секундах                              | 6        |
| STEP1   | UINT |            | крок: 0-невизначений, 2-відкривається, 3-закривається, 1-зупинений в невизначеності, 4 – зупинений у відкритому стані, 5 – зупинений в закритому стані, 6 –заблокований | 8        |
| TSTEP1  | UINT |            | Час кроку в с                                                | 10       |
| TOPNSP  | UINT |            | Максимальний час відкриття в секундах                        |          |
| CNTPER  | UINT |            | Кількість змін положення                                     |          |
| CNTALM  | UINT |            | Кількість аварій                                             |          |

### 2.4.3.Класи VLVA: клапани з аналоговим керуванням(CLSID=16#202x)
Якщо в проекті передбачається використання клапану з кінцевиками, можна задіяти алгоритм з VLVD.
У зв'язці з алгоритмом що має ручний режим DISP та MANBX не треба використовувати.
#### VLVA_HMI

| Атрибут | Тип  | Біт       | Опис                                                         |
| ------- | ---- | --------- | ------------------------------------------------------------ |
| STA     | UINT | 0         | =1                                                           |
|         |      | 1         | =1                                                           |
|         |      | 2 BLCK    | =1 Заблокований                                              |
|         |      | 3         | =1                                                           |
|         |      | 4         | =1                                                           |
|         |      | 5 OPNING  | =1 Відкривається                                             |
|         |      | 6 CLSING  | =1 Закривається                                              |
|         |      | 7 OPNED   | =1 Відкритий (>=95 %)                                        |
|         |      | 8 CLSED   | =1 Закритий (<5 %)                                           |
|         |      | 9 DISP    | =1 дистанційний режим (з ПК/ОП)                              |
|         |      | 10 MANBX  | =1 Ручний зі щита                                            |
|         |      | 11        | =1                                                           |
|         |      | 12 INBUF  | =1                                                           |
|         |      | 13 FRC    | =1 хоча би одна зі змінних в об’єкті форсована (для зручності відображення при наладці) |
|         |      | 14 SML    |                                                              |
|         |      | 15 CMDACK |                                                              |
| CMD     | UINT |           | Команди:<br/>16#0100 – прочитати конфігурація <br/>16#0101 – записати конфігурація<br/>16#0102 – записати конфігурація за замовченням<br/>16#4102 – записати конфігурація за замовченням для усіх клапанів<br/>16#0200 – тимчасово вивести тривогу з експлуатації<br/>16#0201 – ввести тривогу в експлуатацію<br/>16#0202 – підтвердити тривогу<br/><br/>16#0300 – ручний/автомат<br/>16#4301 – перевести в ручний усі об’єкти типу <br/>16#4302 – перевести в автомат усі об’єкти типу |
| VAL     | REAL |           | Значення                                                     |

#### VLVA_CFG

| Атрибут | Тип  | Біт          | Опис                                                      |
| ------- | ---- | ------------ | --------------------------------------------------------- |
| ID      | UINT |              |                                                           |
| CLSID   | UINT |              | 16#2020                                                   |
| STA     | UINT |              |                                                           |
| CMD     | UINT |              |                                                           |
| VAL     | REAL |              | значення                                                  |
| PRM     | UINT | b0           |                                                           |
|         |      | b1           |                                                           |
|         |      | 2 ZOPNENBL   |                                                           |
|         |      | 3 ZCLSENBL   |                                                           |
|         |      | b4           |                                                           |
|         |      | b5           | X5 – використати обмеження по швидкості                   |
|         |      | 6 MANCFG     |                                                           |
|         |      | b7           | X7 – =1, використання клапану (0 – резерв)                |
|         |      | 8 AUTOACK    | X8 – =1, автоматичне підтвердження тривог                 |
|         |      | b9           |                                                           |
|         |      | b10          |                                                           |
|         |      | 11 SPDLMENBL | X11 – =1, включити обмеження по швидкості                 |
|         |      | b12          |                                                           |
|         |      | b13          |                                                           |
|         |      | b14          |                                                           |
|         |      | b15          |                                                           |
| MSG     | UINT |              | Номер останнього діагностичного повідомлення              |
| TDEASP  | UINT |              | Час затримки тривоги в секундах                           |
| STEP1   | UINT |              | Крок                                                      |
| VALPREV | REAL |              | Значення VAL на попередньому перерахунку (2 секунди)      |
| MVAL    | REAL |              | Значення VAL у ручному/форсованому режимі перезаписує VAL |
| CNTPER  | UINT |              | Кількість змін положення                                  |
| CNTALM  | UINT |              | Кількість аварій                                          |
| T_STEP1 | UINT |              | Час кроку в с                                             |
| T_OPN   | UINT |              | Час повного відкриття клапану при обмеженні на швидкість  |
### 2.4.4.Класи VLVSRV: клапани типу МЕО (CLSID=16#203x)



### 2.4.5.Класи DRV: двигуни (CLSID=16#210x)
16#2110 (8464) – без частотника
16#2111 (8465) – з плавним пуском
16#2120 (8480) – з частотником
16#2121 (8481) – насос з аналоговим керуванням
#### VLVD_HMI

| Атрибут | Тип  | Біт       | Опис                                                         |
| ------- | ---- | --------- | ------------------------------------------------------------ |
| STA     | UINT | 0 ALMOPN  | =1 Не відкрився (скидається при зміні команди або стану) датчика) |
|         |      | 1 ALMCLS  | =1 Не закрився (скидається при зміні команди або стану) датчика) |
|         |      | 2 BLCK    | =1 Заблокований                                              |
|         |      | 3 ALMSHFT | =1 Порушення стану                                           |
|         |      | 4 SLNDBRK | =1 Помилка датчику                                           |
|         |      | 5 OPNING  | =1 Відкривається                                             |
|         |      | 6 CLSING  | =1 Закривається                                              |
|         |      | 7 OPNED   | =1 Відкритий (16#0080)                                       |
|         |      | 8 CLSED   | =1 Закритий (16#0100)                                        |
|         |      | 9 DISP    | =1 дистанційний режим (з ПК/ОП) (16#0200)                    |
|         |      | 10 MANBX  | =1 Ручний зі щита                                            |
|         |      | 11 SLNDKZ | =1 КЗ соленоїду                                              |
|         |      | 12 INBUF  | =1 -                                                         |
|         |      | 13 FRC    | =1 хоча би одна зі змінних в об’єкті форсована (для зручності відображення при наладці) |
|         |      | 14 SML    |                                                              |
|         |      | 15 CMDACK |                                                              |
| CMD     | UINT |           | Команди:<br/>16#0001 – CMD_OPN<br/>16#0002 – CMD_CLS<br/>16#0003 – CMD_TOGGLE (перемикання, тільки для моностабільних клапанів)<br/>16#0004 – CMD_ALMACK<br/>16#0007 – CMD_BLCK (блокування)<br/>16#0008 – CMD_DBLK (деблокування)<br/>16#0010 – CMD_STOPTUN<br/>16#0011 – CMD_TUNING (автопідстройка)<br/>16#0100 – прочитати конфігурацію <br/>16#0101 – записати конфігурацію<br/>16#0102 – записати конфігурацію за замовченням<br/>16#4102 – записати конфігурацію за замовченням для усіх клапанів<br/>16#0200 – тимчасово вивести тривогу з експлуатації<br/>16#0201 – ввести тривогу в експлуатацію<br/>16#0202 – підтвердити тривогу<br/>16#0300 – ручний/автомат<br/>16#0301 – ручний<br/>16#0302 – автомат<br/>16#4301 – перевести в ручний усі об’єкти типу<br/>16#4302 – перевести в автомат усі об’єкти типу |
#### VLVD_CFG

| Атрибут | Тип  | Біт        | Опис                                                         |
| ------- | ---- | ---------- | ------------------------------------------------------------ |
| ID      | UINT |            | 16#2011 –  моностабільний режим <br/>16#2012 – бістабільний режим |
| CLSID   | UINT |            |                                                              |
| STA     | UINT |            |                                                              |
| CMD     | UINT |            |                                                              |
| PRM     | UINT | b0         |                                                              |
|         |      | b1         |                                                              |
|         |      | 2 ZOPNENBL |                                                              |
|         |      | 3 ZCLSENBL |                                                              |
|         |      | 4 BISTABLE |                                                              |
|         |      | b5         |                                                              |
|         |      | b6         |                                                              |
|         |      | 7 MANCFG   |                                                              |
|         |      | b8         |                                                              |
|         |      | b9         |                                                              |
|         |      | 10 AUTOACK |                                                              |
|         |      | b11        |                                                              |
|         |      | b12        |                                                              |
|         |      | b13        |                                                              |
|         |      | b14        |                                                              |
|         |      | b15        |                                                              |
| MSG     | UINT |            | Номер останнього діагностичного повідомлення                 |
| TDEASP  | UINT |            | Час затримки тривоги в секундах                              |
| STEP1   | UINT |            | крок: 0-невизначений, 2-відкривається, 3-закривається, 1-зупинений в  невизначеності, 4 – зупинений у відкритому стані, 5 – зупинений в закритому стані, 6 –заблокований |
| TSTEP1  | UINT |            | Час кроку в с                                                |
| TOPNSP  | UINT |            | Максимальний час відкриття в секундах                        |
| CNTPER  | UINT |            | Кількість змін положення                                     |
| CNTALM  | UINT |            | Кількість аварій                                             |
