# Клас CHAI (аналоговий вхідний канал)

**CLSID=16#003x**

## Загальний опис

Реалізує функцію роботи з фізичним дискретним входом на локальному ПЛК або розподіленому засобі вводу/виводу.

Структура змінних CH_CFG та CH_HMI наведена в [структурі класів ](2_lvl0.md)

## Функція CHAIFN

### Функціональні вимоги 

- Загальні функціональні вимоги описані у вимогах до [класів LVL0 ](2_lvl0.md).
- Функція повинна передбачати значення MIN та MAX для можливості простого керування при форсованому значенні. Розділення на MIN та MAX можуть визначатися підкласом CHAIFN.

### Вимоги щодо реалізації інтерфейсу

Вимоги описані щодо реалізації інтерфейсу описані у вимогах до [класів LVL0 ](2_lvl0.md)

### Вимоги щодо реалізації програми користувача

Вимоги описані щодо реалізації інтерфейсу описані у вимогах до [класів LVL0 ](2_lvl0.md)

### Вимоги щодо використання

Вкористовуються перед викликом VAR. 

## Тестування CHAIFN

Цей пункт описує методику перевірки особливих функцій CHAIFN. Інші тести описані в  [описі класу LVL0 ](2_lvl0.md)

### Перелік тестів

Перелік наведений  [в описі класу LVL0 ](2_lvl0.md)

### 3 Робота в нефорсованому режимі

Перевірка значень повинно проходити як для CH_HMI, CH_CFG так і  CH_BUF

- `STA.VRAW=RAWINT>0` за будь яких режимів
- `STA.VAL=CHCFG.VAL>0` за будь яких режимів

| Номер кроку | Дія для перевірки                                            | Очікуваний результат                                         | Примітки |
| ----------- | ------------------------------------------------------------ | ------------------------------------------------------------ | -------- |
| 1           | прив'язати тестову змінну до буферу                          | у CHBUF повинно завантажитися весь зміст CH_CFG              |          |
| 2           | змінити значення вхідної змінної `RAWINT` (аналогового входу) | для CH_HMI, CH_CFG та CH_BUF повинне змінитися: плинне значення змінної `STA.VAL=RAWINT>0`,  значення сирої змінної `STA.VRAW=RAWINT>0`, значення `VAL` |          |
| 3           | повторити п.2 з іншим значенням                              |                                                              |          |

### 4 Робота в режимі форсування

Перевірка значень повинно проходити як для CH_HMI, CH_CFG так і  CH_BUF.

- `STA.VRAW=RAWINT>0` за будь яких режимів
- `STA.VAL=CHCFG.VAL>0` за будь яких режимів

| Номер кроку | Дія для перевірки                                            | Очікуваний результат                                         | Примітки                                  |
| ----------- | ------------------------------------------------------------ | ------------------------------------------------------------ | ----------------------------------------- |
| 1           | прив'язати тестову змінну до буферу                          | у CHBUF повинно завантажитися весь зміст CH_CFG              |                                           |
| 2           | змінити значення вхідної величини `RAWINT` на певне значення | плинне значення змінної `VAL` змінюється на це значення      |                                           |
| 3           | відправити команду форсування CHBUF.CMD=16#301               | біт FRC повинен дорівнювати 1                                |                                           |
| 4           | змінити значення вхідної величини `RAWINT`                   | `CHCFG.VAL=незмінно`<br />`CHBUF.VAL=незмінно`<br />         |                                           |
| 5           | відправити команду 16#1 (записати MAX)                       | `CHCFG.VAL=MAX`<br />`CHBUF.VAL=MAX`<br />                   | значення MAX залежить від підкласу        |
| 6           | відправити команду 16#2 (записати MIN)                       | `CHCFG.VAL=MIN`<br />`CHBUF.VAL=MIN`<br />                   | значення MIN залежить від підкласу        |
| 7           | відправити команду 16#3 (MIDLE)                              | `CHCFG.VAL=(MAX+MIN)/2`<br />`CHBUF.VAL=(MAX+MIN)/2`<br />   | значення MIN та MAX залежить від підкласу |
| 8           | змінити значення CHBUF.VAL                                   | `CHCFG.VAL=значення`<br />                                   |                                           |
| 9           | відправити команду дефорсування CHBUF.CMD=16#302             | біт FRC повинен дорівнювати 0                                |                                           |
| 10          | відправити команду перемикання форсування 16#0300, повторити кілька разів, залишити в режимі форсування | біт FRC повинен перемкнутися на протилежне                   |                                           |
| 11          | перевести в режим форсування кілька змінних                  | біт FRC відповідних змінних повинен дорівнювати 1            |                                           |
| 12          | перевірити значення змінних PLC.STA_PERM і PLC.CNTFRC_PERM   | повинні PLC.STA_PERM.X13=1,  PLC.CNTFRC_PERM дорівнювати кількості зафорсованих змінних |                                           |
| 13          | зняти з режиму форсування усі змінні                         | повинні PLC.STA_PERM.X13=0,  PLC.CNTFRC_PERM=0               |                                           |

